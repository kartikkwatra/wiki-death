!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(e){return e&&e.__esModule?e:{default:e}}(n(3));t.default={people:function(e){return e.map(function(e,t){return r({},e,{index:t,mean_views_adjusted_bd_1:+e.mean_views_adjusted_bd_1,mean_views_adjusted_bd_2:+e.mean_views_adjusted_bd_2,median_views_adjusted_bd_2:+e.median_views_adjusted_bd_2,death_views_2:+e.death_views_2,death_views_adjusted_2:+e.death_views_adjusted_2,thumbnail_width:+e.thumbnail_width,thumbnail_height:+e.thumbnail_height,year_of_birth:+e.year_of_birth,year_of_death:+e.year_of_death,iqr_1:+e.iqr_1,std_1:+e.std_1})})},pageview:function(e){return e.map(function(e){return r({},e,{pageid:e.pageid||"beyonce",bin:+e.bin,bin_death_index:+e.bin_death_index,views:+e.views,views_adjusted:+e.views_adjusted,date:(0,i.default)(e.timestamp)})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),o=null,a=d3.select("#change").select("figure").select("tbody");function s(e){return d3.format(",")(Math.round(e))}t.default={init:function(){new Promise(function(e,t){var n,a=["people"].map(function(e){return"assets/data/"+e+".csv"});(n=d3).loadData.apply(n,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(a).concat([function(n,a){n&&t(n);var s=i.default.people(a[0]);o=s.map(function(e){return r({},e,{change:e.death_views_adjusted_2/e.median_views_adjusted_bd_2})}),e()}]))}).then(function(){!function(){o.sort(function(e,t){return d3.descending(e.change,t.change)});var e=d3.extent(o,function(e){return e.change}),t=d3.scaleLinear().domain(e),n=a.selectAll("tr").data(o).enter().append("tr");n.append("td.name").text(function(e){return e.display.replace(/\(.*\)/g,"").trim()}),n.append("td.avg.number").text(function(e){return s(e.median_views_adjusted_bd_2)}),n.append("td.death.number").text(function(e){return s(e.death_views_adjusted_2)}),n.append("td.change.number").text(function(e){return s(e.change)}).st("background-color",function(e){return"rgba(255, 0, 0, "+t(e.change)+")"})}()})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(e){return e&&e.__esModule?e:{default:e}}(n(0));d3.easeCubicInOut;var o=12,a=null,s=null,c=d3.select("#care").select("figure"),l=c.select("ul"),u="20180712";function d(){window.innerHeight}function f(e){var t=d3.select(this),n=e.mean_views_adjusted_bd_1,r=e.std_1,i=d3.max(e.pageviews,function(e){return e.views_adjusted})-n,o=Math.floor(i/r),a=d3.scaleLinear().domain([0,o]).range([.1,1]);t.selectAll(".day").st("opacity",function(e){var t=(e.views_adjusted-n)/r;return a(t)})}t.default={init:function(){new Promise(function(e,t){var n,c=["people","care"].map(function(e){return"assets/data/"+e+".csv"});(n=d3).loadData.apply(n,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(c).concat([function(n,c){n&&t(n);var l=i.default.people(c[0]);s=i.default.pageview(c[1]),a=l.map(function(e){return r({},e,{pageviews:s.filter(function(t){return t.pageid===e.pageid})})}).map(function(e){var t=e.pageviews.length,n=function(e){var t=e.length;return e[t-1].timestamp===u?null:Math.floor(t/7)}(e.pageviews);return r({},e,{days_until_norm:t,weeks_until_norm:n,week_category:n||0===n?n<=o?n:o+1:o+2})}),e()}]))}).then(function(){d(),function(){var e=d3.nest().key(function(e){return e.week_category}).entries(a).map(function(e){return r({},e,{key:+e.key})}),t=d3.range(o+3).map(function(t){return e.find(function(e){return e.key===t})||{key:t,values:[]}}),n=l.selectAll(".week").data(t).enter().append("li.week");n.append("p.label").html(function(e){return e.key===o+1?e.key+"+":e.key===o+2?"???":e.key+"&nbsp;"}),n.append("ul.people").selectAll(".person").data(function(e){return e.values}).enter().append("li.person").text(function(e){return e.display.replace(/\(.*\)/g,"").trim()})}(),function(){var e=a.filter(function(e){return e.weeks_until_norm});e.sort(function(e,t){return d3.descending(e.days_until_norm,t.days_until_norm)});var t=c.select(".heated-bar").selectAll(".person2").data(e).enter().append("li.person2");t.append("p.label").text(function(e){return e.display.replace(/\(.*\)/g,"").trim()});var n=t.append("ul.days");n.selectAll(".day").data(function(e){return e.pageviews}).enter().append("li.day"),n.each(f)}()})},resize:d}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.substring(0,4),n=+e.substring(4,6)-1,r=e.substring(6,8);return new Date(t,n,r)}},function(e,t,n){e.exports=function(){"use strict";function e(e){for(var t=e.length,n=[],r=0;r<t;r+=1)n.push(e[r]);return n}function t(e){return e instanceof Element?e:"string"==typeof e?document.querySelector(e):null}function n(e){return"scrollama__debug-step--"+e.id+"-"+e.i}function r(e){return"scrollama__debug-offset--"+e.id}function i(e){var t=e.id,i=e.offsetVal,o=e.stepEl,a=o[0].getAttribute("class");o.forEach(function(e,r){return function(e){var t=n({id:e.id,i:e.i}),r=document.createElement("div");r.setAttribute("id",t+"_above"),r.setAttribute("class","scrollama__debug-step"),r.style.position="fixed",r.style.left="0",r.style.width="100%",r.style.backgroundImage="repeating-linear-gradient(45deg, green 0, green 2px, white 0, white 40px)",r.style.border="2px solid green",r.style.opacity="0.33",r.style.zIndex="9999",r.style.display="none",document.body.appendChild(r);var i=document.createElement("div");i.setAttribute("id",t+"_below"),i.setAttribute("class","scrollama__debug-step"),i.style.position="fixed",i.style.left="0",i.style.width="100%",i.style.backgroundImage="repeating-linear-gradient(135deg, orange 0, orange 2px, white 0, white 40px)",i.style.border="2px solid orange",i.style.opacity="0.33",i.style.zIndex="9999",i.style.display="none",document.body.appendChild(i)}({id:t,i:r})}),function(e){var t=e.id,n=e.offsetVal,i=e.stepClass,o=document.createElement("div");o.setAttribute("id",r({id:t})),o.setAttribute("class","scrollama__debug-offset"),o.style.position="fixed",o.style.left="0",o.style.width="100%",o.style.height="0px",o.style.borderTop="2px dashed black",o.style.zIndex="9999";var a=document.createElement("p");a.innerText='".'+i+'" trigger: '+n,a.style.fontSize="12px",a.style.fontFamily="monospace",a.style.color="black",a.style.margin="0",a.style.padding="6px",o.appendChild(a),document.body.appendChild(o)}({id:t,offsetVal:i,stepClass:a})}function o(e){var t=e.id,i=e.stepOffsetHeight,o=e.offsetMargin;e.offsetVal,i.forEach(function(e,r){return function(e){var t=e.h,r=e.offsetMargin,i=n({id:e.id,i:e.i}),o=document.querySelector("#"+i+"_above");o.style.height=t+"px",o.style.top=r-t+"px";var a=document.querySelector("#"+i+"_below");a.style.height=t+"px",a.style.top=r+"px"}({id:t,h:e,i:r,offsetMargin:o})}),function(e){var t=e.offsetMargin,n=r({id:e.id});document.querySelector("#"+n).style.top=t+"px"}({id:t,offsetMargin:o})}function a(e){var t=e.id,r=e.index,i=e.state,o=n({id:t,i:r}),a=document.querySelector("#"+o+"_above"),s=document.querySelector("#"+o+"_below"),c="enter"===i?"block":"none";a&&(a.style.display=c),s&&(s.style.display=c)}return function(){var n=1,r={},s={},c=null,l=null,u=null,d=null,f=0,p=0,v=0,h=0,g=null,m=null,_=null,y=!1,b=!1,w=!1,x=!1,A=0,E=!1,k=!1,j=null,O=null,M=-1,T=null,P=[];function S(e){var t=0;if(e.offsetParent)do{t+=e.offsetTop,e=e.offsetParent}while(e);return t<0?0:t}function Y(e){return+e.getAttribute("data-scrollama-index")}function L(){window.pageYOffset>M?T="down":window.pageYOffset<M&&(T="up"),M=window.pageYOffset}function H(){v=window.innerHeight,h=function(){var e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)}(),_=l?l.getBoundingClientRect():null,p=f*v,g=u?u.map(function(e){return e.offsetHeight}):[],m=u?u.map(S):[],b&&y&&J(),w&&o({id:d,stepOffsetHeight:g,offsetMargin:p,offsetVal:f})}function X(e){e&&!b?(y&&J(),b=!0):e||(s.top&&s.top.disconnect(),s.bottom&&s.bottom.disconnect(),s.stepAbove&&s.stepAbove.forEach(function(e){return e.disconnect()}),s.stepBelow&&s.stepBelow.forEach(function(e){return e.disconnect()}),s.stepProgress&&s.stepProgress.forEach(function(e){return e.disconnect()}),s.viewportAbove&&s.viewportAbove.forEach(function(e){return e.disconnect()}),s.viewportBelow&&s.viewportBelow.forEach(function(e){return e.disconnect()}),b=!1)}function C(e,t){if("above"===t)for(var n=0;n<e;n++){var r=j[n];"enter"===r.state&&B(u[n]),"up"===r.direction&&(I(u[n],"down"),B(u[n]))}else if("below"===t)for(var i=j.length-1;i>e;i--){var o=j[i];"enter"===o.state&&B(u[i]),"down"===o.direction&&(I(u[i],"up"),B(u[i]))}}function I(e,t){void 0===t&&(t=!0);var n=Y(e),i={element:e,index:n,direction:T};j[n].direction=T,j[n].state="enter",E&&t&&"down"===T&&C(n,"above"),E&&t&&"up"===T&&C(n,"below"),r.stepEnter&&"function"==typeof r.stepEnter&&!P[n]&&(r.stepEnter(i,j),w&&a({id:d,index:n,state:"enter"}),k&&(P[n]=!0)),x&&R(e,"down"===T?0:1)}function B(e){var t=Y(e),n={element:e,index:t,direction:T};j[t].direction=T,j[t].state="exit",x&&R(e,"down"===T?1:0),r.stepExit&&"function"==typeof r.stepExit&&(r.stepExit(n,j),w&&a({id:d,index:t,state:"exit"}))}function R(e,t){var n={element:e,index:Y(e),progress:t};r.stepProgress&&"function"==typeof r.stepProgress&&r.stepProgress(n)}function F(){var e={direction:T};O.direction=T,O.state="enter",r.containerEnter&&"function"==typeof r.containerEnter&&r.containerEnter(e)}function z(){var e={direction:T};O.direction=T,O.state="exit",r.containerExit&&"function"==typeof r.containerExit&&r.containerExit(e)}function W(e){L(),e.forEach(function(e){var t=e.isIntersecting,r=e.boundingClientRect,i=e.target,o=r.bottom,a=r.height,s=o-p,c=Y(i),l=j[c];s>=-n&&(t&&"down"===T&&"enter"!==l.state?I(i,T):t||"up"!==T||"enter"!==l.state?!t&&s>=a&&"down"===T&&"enter"===l.state&&B(i):B(i))})}function q(e){L(),e.forEach(function(e){var t=e.isIntersecting,r=e.boundingClientRect,i=e.target,o=r.bottom,a=r.height,s=o-p,c=Y(i),l=j[c];s>=-n&&s<a&&t&&"up"===T&&"enter"!==l.state?I(i,T):s<=n&&!t&&"down"===T&&"enter"===l.state&&B(i)})}function N(e){L(),e.forEach(function(e){var t=e.isIntersecting,n=e.target,r=Y(n),i=j[r];t&&"down"===T&&"enter"!==i.state&&"down"!==i.direction&&(I(n,"down"),B(n))})}function D(e){L(),e.forEach(function(e){var t=e.isIntersecting,n=e.target,r=Y(n),i=j[r];t&&"up"===T&&"enter"!==i.state&&"up"!==i.direction&&(I(n,"up"),B(n))})}function V(e){L(),e.forEach(function(e){var t=e.isIntersecting,r=e.intersectionRatio,i=e.boundingClientRect,o=e.target,a=i.bottom;t&&a-p>=-n&&R(o,+r.toFixed(3))})}function $(e){L();var t=e[0],r=t.isIntersecting,i=t.boundingClientRect;(i.top,i.bottom)>-n&&(r?F():"enter"===O.state&&z())}function G(e){L();var t=e[0],r=t.isIntersecting;t.boundingClientRect.top<n&&(r?F():"enter"===O.state&&z())}function J(){s.viewportAbove&&s.viewportAbove.forEach(function(e){return e.disconnect()}),s.viewportAbove=u.map(function(e,t){var n=m[t],r=-(v-p+g[t]),i=new IntersectionObserver(N,{root:null,rootMargin:n+"px 0px "+r+"px 0px",threshold:0});return i.observe(e),i}),s.viewportBelow&&s.viewportBelow.forEach(function(e){return e.disconnect()}),s.viewportBelow=u.map(function(e,t){var n=-(p+g[t]),r=h-m[t]-g[t]-p,i=new IntersectionObserver(D,{root:null,rootMargin:n+"px 0px "+r+"px 0px",threshold:0});return i.observe(e),i}),s.stepAbove&&s.stepAbove.forEach(function(e){return e.disconnect()}),s.stepAbove=u.map(function(e,t){var n=g[t],r=new IntersectionObserver(W,{root:null,rootMargin:n+"px 0px "+(-v+p)+"px 0px",threshold:0});return r.observe(e),r}),s.stepBelow&&s.stepBelow.forEach(function(e){return e.disconnect()}),s.stepBelow=u.map(function(e,t){var n=-p,r=h-v+g[t]+p,i=new IntersectionObserver(q,{root:null,rootMargin:n+"px 0px "+r+"px 0px",threshold:0});return i.observe(e),i}),x&&(s.stepProgress&&s.stepProgress.forEach(function(e){return e.disconnect()}),s.stepProgress=u.map(function(e,t){var n=g[t]-p+"px 0px "+(-v+p)+"px 0px",r=function(e){for(var t=Math.ceil(e/A),n=[],r=1/t,i=0;i<t;i++)n.push(i*r);return n}(g[t]),i=new IntersectionObserver(V,{root:null,rootMargin:n,threshold:r});return i.observe(e),i})),c&&l&&(function(){s.top&&s.top.unobserve(c);var e={root:null,rootMargin:v+"px 0px -"+v+"px 0px",threshold:0};s.top=new IntersectionObserver($,e),s.top.observe(c)}(),function(){s.bottom&&s.bottom.unobserve(c);var e={root:null,rootMargin:"-"+_.height+"px 0px "+_.height+"px 0px",threshold:0};s.bottom=new IntersectionObserver(G,e),s.bottom.observe(c)}())}var K={setup:function(n){var r=n.container,o=n.graphic,a=n.step,s=n.offset;void 0===s&&(s=.5);var p=n.progress;void 0===p&&(p=!1);var v=n.threshold;void 0===v&&(v=4);var h=n.debug;void 0===h&&(h=!1);var g=n.order;void 0===g&&(g=!0);var m=n.once;return void 0===m&&(m=!1),d=function(){var e="abcdefghijklmnopqrstuv",t=e.length,n=(new Date).getTime();return""+[0,0,0].map(function(n){return e[Math.floor(Math.random()*t)]}).join("")+n}(),u=function(t,n){return void 0===n&&(n=document),"string"==typeof t?e(n.querySelectorAll(t)):t instanceof NodeList?e(t):t instanceof Array?t:[]}(a),c=r?t(r):null,l=o?t(o):null,u.length?(w=h,x=p,E=g,k=m,K.offsetTrigger(s),A=Math.max(1,+v),y=!0,w&&i({id:d,stepEl:u,offsetVal:f}),u.forEach(function(e,t){return e.setAttribute("data-scrollama-index",t)}),j=u.map(function(){return{direction:null,state:null}}),O={direction:null,state:null},H(),X(!0),K):(console.error("scrollama error: no step elements"),K)},resize:function(){return H(),K},enable:function(){return X(!0),K},disable:function(){return X(!1),K},destroy:function(){X(!1),Object.keys(r).forEach(function(e){return r[e]=null}),Object.keys(s).forEach(function(e){return s[e]=null})},offsetTrigger:function(e){return e&&(isNaN(e),1)?(f=Math.min(Math.max(0,e),1),K):f},onStepEnter:function(e){return r.stepEnter=e,K},onStepExit:function(e){return r.stepExit=e,K},onStepProgress:function(e){return r.stepProgress=e,K},onContainerEnter:function(e){return r.containerEnter=e,K},onContainerExit:function(e){return r.containerExit=e,K}};return K}}()},function(e,t){!function(t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=!1;if(t.getComputedStyle){var o=n.createElement("div");["","-webkit-","-moz-","-ms-"].some(function(e){try{o.style.position=e+"sticky"}catch(e){}return""!=o.style.position})&&(i=!0)}else i=!0;var a="undefined"!=typeof ShadowRoot,s={top:null,left:null},c=[];function l(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function u(e){return parseFloat(e)||0}function d(e){for(var t=0;e;)t+=e.offsetTop,e=e.offsetParent;return t}var f=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof HTMLElement))throw new Error("First argument must be HTMLElement");if(c.some(function(e){return e._node===t}))throw new Error("Stickyfill is already applied to this node");this._node=t,this._stickyMode=null,this._active=!1,c.push(this),this.refresh()}return r(e,[{key:"refresh",value:function(){if(!i&&!this._removed){this._active&&this._deactivate();var e=this._node,r=getComputedStyle(e),o={top:r.top,display:r.display,marginTop:r.marginTop,marginBottom:r.marginBottom,marginLeft:r.marginLeft,marginRight:r.marginRight,cssFloat:r.cssFloat};if(!isNaN(parseFloat(o.top))&&"table-cell"!=o.display&&"none"!=o.display){this._active=!0;var s=e.parentNode,c=a&&s instanceof ShadowRoot?s.host:s,f=e.getBoundingClientRect(),p=c.getBoundingClientRect(),v=getComputedStyle(c);this._parent={node:c,styles:{position:c.style.position},offsetHeight:c.offsetHeight},this._offsetToWindow={left:f.left,right:n.documentElement.clientWidth-f.right},this._offsetToParent={top:f.top-p.top-u(v.borderTopWidth),left:f.left-p.left-u(v.borderLeftWidth),right:-f.right+p.right-u(v.borderRightWidth)},this._styles={position:e.style.position,top:e.style.top,bottom:e.style.bottom,left:e.style.left,right:e.style.right,width:e.style.width,marginTop:e.style.marginTop,marginLeft:e.style.marginLeft,marginRight:e.style.marginRight};var h=u(o.top);this._limits={start:f.top+t.pageYOffset-h,end:p.top+t.pageYOffset+c.offsetHeight-u(v.borderBottomWidth)-e.offsetHeight-h-u(o.marginBottom)};var g=v.position;"absolute"!=g&&"relative"!=g&&(c.style.position="relative"),this._recalcPosition();var m=this._clone={};m.node=n.createElement("div"),l(m.node.style,{width:f.right-f.left+"px",height:f.bottom-f.top+"px",marginTop:o.marginTop,marginBottom:o.marginBottom,marginLeft:o.marginLeft,marginRight:o.marginRight,cssFloat:o.cssFloat,padding:0,border:0,borderSpacing:0,fontSize:"1em",position:"static"}),s.insertBefore(m.node,e),m.docOffsetTop=d(m.node)}}}},{key:"_recalcPosition",value:function(){if(this._active&&!this._removed){var e=s.top<=this._limits.start?"start":s.top>=this._limits.end?"end":"middle";if(this._stickyMode!=e){switch(e){case"start":l(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:this._offsetToParent.top+"px",bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"middle":l(this._node.style,{position:"fixed",left:this._offsetToWindow.left+"px",right:this._offsetToWindow.right+"px",top:this._styles.top,bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"end":l(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:"auto",bottom:0,width:"auto",marginLeft:0,marginRight:0})}this._stickyMode=e}}}},{key:"_fastCheck",value:function(){this._active&&!this._removed&&(Math.abs(d(this._clone.node)-this._clone.docOffsetTop)>1||Math.abs(this._parent.node.offsetHeight-this._parent.offsetHeight)>1)&&this.refresh()}},{key:"_deactivate",value:function(){var e=this;this._active&&!this._removed&&(this._clone.node.parentNode.removeChild(this._clone.node),delete this._clone,l(this._node.style,this._styles),delete this._styles,c.some(function(t){return t!==e&&t._parent&&t._parent.node===e._parent.node})||l(this._parent.node.style,this._parent.styles),delete this._parent,this._stickyMode=null,this._active=!1,delete this._offsetToWindow,delete this._offsetToParent,delete this._limits)}},{key:"remove",value:function(){var e=this;this._deactivate(),c.some(function(t,n){if(t._node===e._node)return c.splice(n,1),!0}),this._removed=!0}}]),e}(),p={stickies:c,Sticky:f,addOne:function(e){if(!(e instanceof HTMLElement)){if(!e.length||!e[0])return;e=e[0]}for(var t=0;t<c.length;t++)if(c[t]._node===e)return c[t];return new f(e)},add:function(e){if(e instanceof HTMLElement&&(e=[e]),e.length){for(var t=[],n=function(n){var r=e[n];return r instanceof HTMLElement?c.some(function(e){if(e._node===r)return t.push(e),!0})?"continue":void t.push(new f(r)):(t.push(void 0),"continue")},r=0;r<e.length;r++)n(r);return t}},refreshAll:function(){c.forEach(function(e){return e.refresh()})},removeOne:function(e){if(!(e instanceof HTMLElement)){if(!e.length||!e[0])return;e=e[0]}c.some(function(t){if(t._node===e)return t.remove(),!0})},remove:function(e){if(e instanceof HTMLElement&&(e=[e]),e.length)for(var t=function(t){var n=e[t];c.some(function(e){if(e._node===n)return e.remove(),!0})},n=0;n<e.length;n++)t(n)},removeAll:function(){for(;c.length;)c[0].remove()}};i||function(){function e(){t.pageXOffset!=s.left?(s.top=t.pageYOffset,s.left=t.pageXOffset,p.refreshAll()):t.pageYOffset!=s.top&&(s.top=t.pageYOffset,s.left=t.pageXOffset,c.forEach(function(e){return e._recalcPosition()}))}e(),t.addEventListener("scroll",e),t.addEventListener("resize",p.refreshAll),t.addEventListener("orientationchange",p.refreshAll);var r=void 0;function i(){r=setInterval(function(){c.forEach(function(e){return e._fastCheck()})},500)}var o=void 0,a=void 0;"hidden"in n?(o="hidden",a="visibilitychange"):"webkitHidden"in n&&(o="webkitHidden",a="webkitvisibilitychange"),a?(n[o]||i(),n.addEventListener(a,function(){n[o]?clearInterval(r):i()})):i()}(),void 0!==e&&e.exports?e.exports=p:t.Stickyfill=p}(window,document)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=s(n(5)),o=s(n(4)),a=s(n(0));function s(e){return e&&e.__esModule?e:{default:e}}var c={top:20,bottom:40,left:40,right:20},l=12,u="57317",d=new Date(2016,2,1),f=new Date(2016,3,27),p=3,v=3e3,h=d3.easeCubicInOut,g=0,m=0,_=null,y=null,b=null,w="context",x=d3.select("#perspective"),A=x.select("article").selectAll(".step"),E=x.select("figure"),k=E.select(".figure__chart"),j=k.select("svg"),O=j.select(".g-vis"),M=j.select(".g-axis"),T=O.select(".people"),P=(0,o.default)();function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b[0].pageviews;return d3.scaleTime().domain(d3.extent(e,function(e){return e.date})).nice().range([0,g])}function Y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b[0].pageviews,t=d3.max(e,function(e){return e.views_adjusted});return d3.scaleLinear().domain([0,t]).nice().range([m,0])}function L(e){var t=e.scaleX,n=e.scaleY;return d3.line().x(function(e){return t(e.date)}).y(function(e){return n(e.views_adjusted)}).curve(d3.curveMonotoneX).defined(function(e){return e.views_adjusted})}function H(e){var t=e.scaleX,n=e.scaleY,r=e.dur,i=e.ticks,o=void 0===i?d3.timeMonth.every(1):i,a=d3.axisLeft(n).tickFormat(function(e,t){return d3.format(".2s")(e)+(6===t?" pageviews":"")}).tickSize(-g).ticks(5);M.select(".axis--y").transition().duration(r.slow).ease(h).call(a).at("transform","translate("+c.left+", "+c.top+")"),M.select(".axis--y .tick:last-of-type").select("text").at("text-anchor","start").at("transform","translate("+(12-c.left)+", 0)");var s=d3.axisBottom(t).ticks(o).tickSize(0).tickPadding(0).tickFormat(function(e){return(d3.timeYear(e)<e?d3.timeFormat("%b"):d3.timeFormat("%Y"))(e)});M.select(".axis--x").transition().duration(r.slow).ease(h).call(s).at("transform","translate("+c.left+", "+(m+c.bottom-l)+")")}function X(e,t){var n=e.selectAll("path"),r=n.node().getTotalLength(),i=t?r-t:r;n.at({"stroke-dasharray":r+" "+r,"stroke-dashoffset":i})}function C(e){e.at("data-id",function(e){return e.pageid}),e.append("path"),e.append("g.circles")}function I(e,t){var n=t.scaleX,r=t.scaleY,i=t.r,o=void 0===i?p:i,a=e.select(".circles").selectAll("circle").data(function(e){return e.pageviews.filter(function(e){return["beyonce",u].includes(e.pageid)||0===e.bin_death_index})},function(e){return e.timestamp});a.enter().append("circle").classed("is-not-death-index",function(e){return 0!==e.bin_death_index}).at({cx:0,cy:0,r:o}).at("transform",function(e){return"translate("+n(e.date)+", "+r(e.views_adjusted)+")"}),a.exit().remove()}function B(e,t){var n=t.scaleX,r=t.scaleY,i=t.render,o=void 0===i||i,a=L({scaleX:n,scaleY:r});e.selectAll("path").data(function(e){return[e.pageviews]}),o&&e.selectAll("path").at("d",a)}function R(e,t){var n=t.start,i=void 0===n?-1:n,o=t.end,a=void 0===o?0:o;return e.map(function(e){return r({},e)}).filter(function(e){return e.bin_death_index>=i&&e.bin_death_index<=a})}function F(e){var t=_.find(function(e){return e.pageid===u}).pageviews;return t[t.map(function(t,n){return{i:n,date:t.date,diff:t.date-e}}).filter(function(e){return e.diff>0})[0].i].bin_death_index}function z(e){var t=e.leave,n=e.reverse,r=1;t?r=0:n&&(r=.33);var i=v*r;return{slow:i,medium:Math.floor(.33*i),fast:Math.floor(.1*i)}}var W={context:function(e){var t=e.reverse,n=z({leave:e.leave,reverse:t}),r=b,i=S(),o=Y();H({scaleX:i,scaleY:o,dur:n});var a=T.selectAll(".person").data(r,function(e){return e.pageid}),s=a.enter().append("g.person").call(C).merge(a);s.call(B,{scaleX:i,scaleY:o}),s.call(I,{scaleX:i,scaleY:o}),s.classed("is-highlight",!0),a.exit().transition().duration(n.fast).st("opacity",0).remove()},"prince-before":function(e){var t=e.reverse,n=e.leave;t||n||W.context({leave:!0});var i=z({leave:n,reverse:t}),o=F(d),a=_.filter(function(e){return e.pageid===u}).map(function(e){return r({},e,{pageviews:R(e.pageviews,{start:o,end:-1})})}).concat(b),s=S(),c=Y();H({scaleX:s,scaleY:c,dur:i});var l=T.selectAll(".person").data(a,function(e){return e.pageid}),f=l.enter().append("g.person").call(C).merge(l);f.call(I,{scaleX:s,scaleY:c,r:0}),f.call(B,{scaleX:s,scaleY:c,render:!t});var v=L({scaleX:s,scaleY:c});if(t)f.selectAll("path").transition().duration(i.slow).ease(h).at("d",v).st("opacity",1),f.selectAll("circle").transition().duration(i.slow).ease(h).st("opacity",1).at("transform",function(e){return"translate("+s(e.date)+", "+c(e.views_adjusted)+")"});else{var g=f.filter(function(e){return e.pageid===u});g.call(X),g.selectAll("path").transition().duration(i.slow).ease(h).at("stroke-dashoffset",0),g.selectAll("circle").transition().duration(i.medium).delay(function(e,t,n){return i.slow+t/n.length*i.fast}).ease(h).at("r",function(e){return 0===e.bin_death_index?12:p})}f.classed("is-highlight",function(e){return e.pageid===u}),f.filter(function(e){return e.pageid===u}).raise()},"prince-spike":function(e){var t=e.reverse,n=e.leave;t||n||W["prince-before"]({leave:!0});var i=z({leave:n,reverse:t}),o=F(d),a=_.filter(function(e){return e.pageid===u}).map(function(e){return r({},e,{pageviews:R(e.pageviews,{start:o,end:0})})}).concat(b),s=a.find(function(e){return e.pageid===u}).pageviews,c=S(),l=Y(s);H({scaleX:c,scaleY:l,dur:i});var f=T.selectAll(".person").data(a,function(e){return e.pageid}),v=f.enter().append("g.person").call(C).merge(f),g=function(e){var r=v.filter(function(e){return e.pageid===u}),o=r.selectAll("path").node().getTotalLength();r.call(B,{scaleX:c,scaleY:l}),r.call(I,{scaleX:c,scaleY:l,r:0}),n||t||r.call(X,o),r.selectAll("path").transition().duration(i.slow).ease(h).at("stroke-dashoffset",0),r.selectAll("circle").transition().duration(i.medium).delay(i.slow).ease(h).at("r",function(e){return 0===e.bin_death_index?12:p})},m=L({scaleX:c,scaleY:l});t?(v.call(I,{scaleX:c,scaleY:l}),v.call(B,{scaleX:c,scaleY:l,render:!t}),v.selectAll("path").transition().duration(i.slow).ease(h).at("d",m).st("opacity",1),v.selectAll("circle").transition().duration(i.slow).ease(h).st("opacity",1).at("transform",function(e){return"translate("+c(e.date)+", "+l(e.views_adjusted)+")"})):(v.selectAll("path").transition().duration(i.slow).ease(h).at("d",m).st("opacity",1).on("end",function(e){e[0].pageid!==u||n||g()}),v.selectAll("circle").transition().duration(i.slow).ease(h).st("opacity",1).at("transform",function(e){return"translate("+c(e.date)+", "+l(e.views_adjusted)+")"})),v.classed("is-highlight",function(e){return e.pageid===u}),v.filter(function(e){return e.pageid===u}).raise(),f.exit().transition().duration(i.medium).st("opacity",0).remove(),n&&!t&&g()},others:function(e){var t=e.reverse,n=e.leave;t||n||W["prince-spike"]({leave:!0});var i=z({leave:n,reverse:t}),o=_.map(function(e){return r({},e,{pageviews:R(e.pageviews,{start:-50,end:0})})});o.sort(function(e,t){return d3.descending(e.death_views_adjusted_2,t.death_views_adjusted_2)});var a=S(y),s=Y(y),c=function(e){return d3.scaleSqrt().domain(d3.extent(e,function(e){return e.death_views_adjusted_2})).nice().range([p,12])}(o);H({scaleX:a,scaleY:s,dur:i,ticks:null}),o.sort(function(e,t){return d3.ascending(+e.timestamp_of_death,+t.timestamp_of_death)});var l=T.selectAll(".person").data(o,function(e){return e.pageid}),d=l.enter().append("g.person").call(C),f=function(){var e=d.merge(l);e.call(B,{scaleX:a,scaleY:s}),e.call(I,{scaleX:a,scaleY:s,r:0}),e.selectAll("circle").transition().duration(i.medium).delay(function(e){var t=_.find(function(t){return t.pageid===e.pageid}).index;return i.slow*(t/_.length)}).ease(h).at("r",function(e){return c(e.views_adjusted)}),e.selectAll(".is-not-death-index").classed("is-transparent",!0),e.selectAll("path").classed("is-transparent",!0)},v=L({scaleX:a,scaleY:s});l.selectAll("path").transition().duration(i.slow).ease(h).at("d",v).st("opacity",0).on("end",function(e){e[0].pageid!==u||n||f()}),l.selectAll("circle").transition().duration(i.slow).ease(h).st("opacity",function(e){return 0===e.bin_death_index?1:0}).at("transform",function(e){return"translate("+a(e.date)+", "+s(e.views_adjusted)+")"}),l.classed("is-highlight",!1),l.exit().transition().duration(i.fast).st("opacity",0).remove(),n&&!t&&f()}};function q(e){var t=e.reverse,n=void 0===t||t,r=e.leave,i=void 0!==r&&r;console.log({currentStep:w,reverse:n,leave:i}),W[w]&&W[w]({reverse:n,leave:i})}function N(){!function(){var e=window.innerHeight;m=Math.floor(.8*e)-c.top-c.bottom,g=k.node().offsetWidth-c.left-c.right}(),j.at({width:g+c.left+c.right,height:m+c.top+c.bottom}),O.at("transform","translate("+c.left+", "+c.top+")"),A.st("padding-bottom",Math.floor(.98*window.innerHeight)),q({})}function D(e){e.index;var t=e.element,n=e.direction;w=d3.select(t).at("data-step"),q({reverse:"up"===n})}t.default={init:function(){new Promise(function(e,t){var n,i=["people","perspective","beyonce"].map(function(e){return"assets/data/"+e+".csv"});(n=d3).loadData.apply(n,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(i).concat([function(n,i){n&&t(n);var o=a.default.people(i[0]);y=a.default.pageview(i[1]),_=o.map(function(e){return r({},e,{pageviews:y.filter(function(t){return t.pageid===e.pageid})})});var s=a.default.pageview(i[2]);b=[{pageid:"beyonce",pageviews:s.filter(function(e){return e.date>=d&&e.date<f})}],e()}]))}).then(function(){N(),i.default.add(E.node()),P.setup({step:A.nodes(),offset:.95}).onStepEnter(D)})},resize:N}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={android:function(){return navigator.userAgent.match(/Android/i)},blackberry:function(){return navigator.userAgent.match(/BlackBerry/i)},ios:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},opera:function(){return navigator.userAgent.match(/Opera Mini/i)},windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return r.android()||r.blackberry()||r.ios()||r.opera()||r.windows()}};t.default=r},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){(function(t){var n=NaN,r="[object Symbol]",i=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,c=parseInt,l="object"==typeof t&&t&&t.Object===Object&&t,u="object"==typeof self&&self&&self.Object===Object&&self,d=l||u||Function("return this")(),f=Object.prototype.toString,p=Math.max,v=Math.min,h=function(){return d.Date.now()};function g(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function m(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&f.call(e)==r}(e))return n;if(g(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=g(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(i,"");var l=a.test(e);return l||s.test(e)?c(e.slice(2),l?2:8):o.test(e)?n:+e}e.exports=function(e,t,n){var r,i,o,a,s,c,l=0,u=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function _(t){var n=r,o=i;return r=i=void 0,l=t,a=e.apply(o,n)}function y(e){var n=e-c;return void 0===c||n>=t||n<0||d&&e-l>=o}function b(){var e=h();if(y(e))return w(e);s=setTimeout(b,function(e){var n=t-(e-c);return d?v(n,o-(e-l)):n}(e))}function w(e){return s=void 0,f&&r?_(e):(r=i=void 0,a)}function x(){var e=h(),n=y(e);if(r=arguments,i=this,c=e,n){if(void 0===s)return function(e){return l=e,s=setTimeout(b,t),u?_(e):a}(c);if(d)return s=setTimeout(b,t),_(c)}return void 0===s&&(s=setTimeout(b,t)),a}return t=m(t)||0,g(n)&&(u=!!n.leading,o=(d="maxWait"in n)?p(m(n.maxWait)||0,t):o,f="trailing"in n?!!n.trailing:f),x.cancel=function(){void 0!==s&&clearTimeout(s),l=0,r=c=i=s=void 0},x.flush=function(){return void 0===s?a:w(h())},x}}).call(this,n(8))},function(e,t,n){"use strict";var r=s(n(9)),i=s(n(7)),o=(s(n(6)),s(n(2))),a=s(n(1));function s(e){return e&&e.__esModule?e:{default:e}}var c=d3.select("body"),l=0;c.classed("is-mobile",i.default.any()),window.addEventListener("resize",(0,r.default)(function(){var e=c.node().offsetWidth;l!==e&&(l=e,o.default.resize())},150)),function(){if(c.select("header").classed("is-sticky")){var e=c.select(".header__menu"),t=c.select(".header__toggle");t.on("click",function(){var n=e.classed("is-visible");e.classed("is-visible",!n),t.classed("is-visible",!n)})}}(),a.default.init(),o.default.init()}]);