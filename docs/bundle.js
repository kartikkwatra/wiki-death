!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=15)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},o=function(t){return t&&t.__esModule?t:{default:t}}(n(8));e.default={people:function(t){return t.map(function(t,e){return i({},t,{index:e,display:t.display.replace(/\(.*\)/g,"").trim(),mean_views_adjusted_bd_1:+t.mean_views_adjusted_bd_1,mean_views_adjusted_bd_2:+t.mean_views_adjusted_bd_2,median_views_adjusted_bd_2:+t.median_views_adjusted_bd_2,death_views_2:+t.death_views_2,death_views_adjusted_2:+t.death_views_adjusted_2,thumbnail_width:+t.thumbnail_width,thumbnail_height:+t.thumbnail_height,year_of_birth:+t.year_of_birth,year_of_death:+t.year_of_death,iqr_1:+t.iqr_1,std_1:+t.std_1})})},pageview:function(t){return t.map(function(t){return i({},t,{pageid:t.pageid||"beyonce",bin:+t.bin,bin_death_index:+t.bin_death_index,views:+t.views,views_adjusted:+t.views_adjusted,date:(0,o.default)(t.timestamp)})})},ma:function(t){return t.map(function(t){return i({},t,{pageid:t.pageid,bin_death_index:+t.bin_death_index,ma:+t.ma,diff:+t.diff,diff_percent:+t.diff_percent,diff_views:+t.diff_views,diff_percent_views:+t.diff_percent_views})})}}},function(t,e,n){"use strict";var i;function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}Object.defineProperty(e,"__esModule",{value:!0}),e.default={primary:(i={hex:"#008080"},o(i,"hex","#ff4500"),o(i,"hex","#5b5b5b"),o(i,"rgb",[0,128,128]),o(i,"rgb",[255,69,0]),o(i,"rgb",[91,91,91]),i)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return t&&t.__esModule?t:{default:t}}(n(7)),o=d3.select("header").node().offsetHeight;e.default={init:function(t){var e=t.container,n=e.append("div.tooltip"),i=e.append("div.tooltip.tooltip--hidden");return[n,i].forEach(function(t){var e=t.append("div.info"),n=e.append("p.display");n.append("span.name"),n.append("span.date-of-death");var i=e.append("p.bio");i.append("div.thumbnail"),i.append("span"),t.append("div.stats")}),[n,i]},show:function(t){var e=t.el,n=t.d,r=t.pos,a=(0,i.default)({text:n.extract,chars:150,clean:!0,ellipses:!0});e.forEach(function(t){t.select(".name").text(n.display),t.select(".date-of-death").text(n.date_of_death+", "+n.year_of_death),t.select(".bio span").text(a),t.select(".thumbnail").st("background-image","url("+n.thumbnail_source+")")});var s=r.x,c=r.y;e[1].st({top:c,left:s});var u=function(t){var e=t.el,n=t.pos;e[1].st({top:n.y,left:n.x});var i=e[1].node().getBoundingClientRect(),r=i.top,a=i.left,s=i.right,c={center:!0,left:!1,right:!1,bottom:!1};return r-o<0&&(c.bottom=!0),s>window.innerWidth-32&&(c.center=!1,c.right=!0),a<32&&(c.center=!1,c.left=!0),c}({el:e,pos:r});e[0].st({top:c,left:s}).classed("is-visible",!0).classed("is-center",u.center).classed("is-right",u.right).classed("is-left",u.left).classed("is-bottom",u.bottom)},hide:function(t){t[0].classed("is-visible",!1)}}},function(t,e,n){"use strict";n.r(e);var i="http://www.w3.org/1999/xhtml",o={svg:"http://www.w3.org/2000/svg",xhtml:i,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},r=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),o.hasOwnProperty(e)?{space:o[e],local:t}:t},a=function(t){var e=r(t);return(e.local?function(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}:function(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===i&&e.documentElement.namespaceURI===i?e.createElement(t):e.createElementNS(n,t)}})(e)},s=0;function c(){this._="@"+(++s).toString(36)}c.prototype=function(){return new c}.prototype={constructor:c,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};var u=function(t){return function(){return this.matches(t)}};if("undefined"!=typeof document){var l=document.documentElement;if(!l.matches){var h=l.webkitMatchesSelector||l.msMatchesSelector||l.mozMatchesSelector||l.oMatchesSelector;u=function(t){return function(){return h.call(this,t)}}}}var f=u,d={},p=null;function _(t,e,n){return t=y(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function y(t,e,n){return function(i){var o=p;p=i;try{t.call(this,this.__data__,e,n)}finally{p=o}}}function v(t){return function(){var e=this.__on;if(e){for(var n,i=0,o=-1,r=e.length;i<r;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++o]=n:this.removeEventListener(n.type,n.listener,n.capture);++o?e.length=o:delete this.__on}}}function g(t,e,n){var i=d.hasOwnProperty(t.type)?_:y;return function(o,r,a){var s,c=this.__on,u=i(e,r,a);if(c)for(var l=0,h=c.length;l<h;++l)if((s=c[l]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=u,s.capture=n),void(s.value=e);this.addEventListener(t.type,u,n),s={type:t.type,name:t.name,value:e,listener:u,capture:n},c?c.push(s):this.__on=[s]}}function m(t,e,n,i){var o=p;t.sourceEvent=p,p=t;try{return e.apply(n,i)}finally{p=o}}"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(d={mouseenter:"mouseover",mouseleave:"mouseout"}));var x=function(){for(var t,e=p;t=e.sourceEvent;)e=t;return e},b=function(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]},w=function(t){var e=x();return e.changedTouches&&(e=e.changedTouches[0]),b(t,e)};function M(){}var j=function(t){return null==t?M:function(){return this.querySelector(t)}};function k(){return[]}var A=function(t){return new Array(t.length)};function O(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}O.prototype={constructor:O,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var S="$";function T(t,e,n,i,o,r){for(var a,s=0,c=e.length,u=r.length;s<u;++s)(a=e[s])?(a.__data__=r[s],i[s]=a):n[s]=new O(t,r[s]);for(;s<c;++s)(a=e[s])&&(o[s]=a)}function E(t,e,n,i,o,r,a){var s,c,u,l={},h=e.length,f=r.length,d=new Array(h);for(s=0;s<h;++s)(c=e[s])&&(d[s]=u=S+a.call(c,c.__data__,s,e),u in l?o[s]=c:l[u]=c);for(s=0;s<f;++s)(c=l[u=S+a.call(t,r[s],s,r)])?(i[s]=c,c.__data__=r[s],l[u]=null):n[s]=new O(t,r[s]);for(s=0;s<h;++s)(c=e[s])&&l[d[s]]===c&&(o[s]=c)}function P(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var N=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView};function C(t){return t.trim().split(/^|\s+/)}function Y(t){return t.classList||new R(t)}function R(t){this._node=t,this._names=C(t.getAttribute("class")||"")}function B(t,e){for(var n=Y(t),i=-1,o=e.length;++i<o;)n.add(e[i])}function X(t,e){for(var n=Y(t),i=-1,o=e.length;++i<o;)n.remove(e[i])}function I(){this.textContent=""}function L(){this.innerHTML=""}function D(){this.nextSibling&&this.parentNode.appendChild(this)}function q(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function z(){return null}function H(){var t=this.parentNode;t&&t.removeChild(this)}function W(t,e,n){var i=N(t),o=i.CustomEvent;o?o=new o(e,n):(o=i.document.createEvent("Event"),n?(o.initEvent(e,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(e,!1,!1)),t.dispatchEvent(o)}R.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var F=[null];function V(t,e){this._groups=t,this._parents=e}V.prototype=function(){return new V([[document.documentElement]],F)}.prototype={constructor:V,select:function(t){"function"!=typeof t&&(t=j(t));for(var e=this._groups,n=e.length,i=new Array(n),o=0;o<n;++o)for(var r,a,s=e[o],c=s.length,u=i[o]=new Array(c),l=0;l<c;++l)(r=s[l])&&(a=t.call(r,r.__data__,l,s))&&("__data__"in r&&(a.__data__=r.__data__),u[l]=a);return new V(i,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=function(t){return null==t?k:function(){return this.querySelectorAll(t)}}(t));for(var e=this._groups,n=e.length,i=[],o=[],r=0;r<n;++r)for(var a,s=e[r],c=s.length,u=0;u<c;++u)(a=s[u])&&(i.push(t.call(a,a.__data__,u,s)),o.push(a));return new V(i,o)},filter:function(t){"function"!=typeof t&&(t=f(t));for(var e=this._groups,n=e.length,i=new Array(n),o=0;o<n;++o)for(var r,a=e[o],s=a.length,c=i[o]=[],u=0;u<s;++u)(r=a[u])&&t.call(r,r.__data__,u,a)&&c.push(r);return new V(i,this._parents)},data:function(t,e){if(!t)return d=new Array(this.size()),u=-1,this.each(function(t){d[++u]=t}),d;var n=e?E:T,i=this._parents,o=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var r=o.length,a=new Array(r),s=new Array(r),c=new Array(r),u=0;u<r;++u){var l=i[u],h=o[u],f=h.length,d=t.call(l,l&&l.__data__,u,i),p=d.length,_=s[u]=new Array(p),y=a[u]=new Array(p);n(l,h,_,y,c[u]=new Array(f),d,e);for(var v,g,m=0,x=0;m<p;++m)if(v=_[m]){for(m>=x&&(x=m+1);!(g=y[x])&&++x<p;);v._next=g||null}}return(a=new V(a,i))._enter=s,a._exit=c,a},enter:function(){return new V(this._enter||this._groups.map(A),this._parents)},exit:function(){return new V(this._exit||this._groups.map(A),this._parents)},merge:function(t){for(var e=this._groups,n=t._groups,i=e.length,o=n.length,r=Math.min(i,o),a=new Array(i),s=0;s<r;++s)for(var c,u=e[s],l=n[s],h=u.length,f=a[s]=new Array(h),d=0;d<h;++d)(c=u[d]||l[d])&&(f[d]=c);for(;s<i;++s)a[s]=e[s];return new V(a,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,o=t[e],r=o.length-1,a=o[r];--r>=0;)(i=o[r])&&(a&&a!==i.nextSibling&&a.parentNode.insertBefore(i,a),a=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=P);for(var n=this._groups,i=n.length,o=new Array(i),r=0;r<i;++r){for(var a,s=n[r],c=s.length,u=o[r]=new Array(c),l=0;l<c;++l)(a=s[l])&&(u[l]=a);u.sort(e)}return new V(o,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],o=0,r=i.length;o<r;++o){var a=i[o];if(a)return a}return null},size:function(){var t=0;return this.each(function(){++t}),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var o,r=e[n],a=0,s=r.length;a<s;++a)(o=r[a])&&t.call(o,o.__data__,a,r);return this},attr:function(t,e){var n=r(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}}:"function"==typeof e?n.local?function(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}:function(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}:n.local?function(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}:function(t,e){return function(){this.setAttribute(t,e)}})(n,e))},style:function(t,e,n){var i;return arguments.length>1?this.each((null==e?function(t){return function(){this.style.removeProperty(t)}}:"function"==typeof e?function(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}:function(t,e,n){return function(){this.style.setProperty(t,e,n)}})(t,e,null==n?"":n)):N(i=this.node()).getComputedStyle(i,null).getPropertyValue(t)},property:function(t,e){return arguments.length>1?this.each((null==e?function(t){return function(){delete this[t]}}:"function"==typeof e?function(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}:function(t,e){return function(){this[t]=e}})(t,e)):this.node()[t]},classed:function(t,e){var n=C(t+"");if(arguments.length<2){for(var i=Y(this.node()),o=-1,r=n.length;++o<r;)if(!i.contains(n[o]))return!1;return!0}return this.each(("function"==typeof e?function(t,e){return function(){(e.apply(this,arguments)?B:X)(this,t)}}:e?function(t){return function(){B(this,t)}}:function(t){return function(){X(this,t)}})(n,e))},text:function(t){return arguments.length?this.each(null==t?I:("function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}:function(t){return function(){this.textContent=t}})(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?L:("function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}:function(t){return function(){this.innerHTML=t}})(t)):this.node().innerHTML},raise:function(){return this.each(D)},lower:function(){return this.each(q)},append:function(t){var e="function"==typeof t?t:a(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:a(t),i=null==e?z:"function"==typeof e?e:j(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(H)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,o,r=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}(t+""),a=r.length;if(!(arguments.length<2)){for(s=e?g:v,null==n&&(n=!1),i=0;i<a;++i)this.each(s(r[i],e,n));return this}var s=this.node().__on;if(s)for(var c,u=0,l=s.length;u<l;++u)for(i=0,c=s[u];i<a;++i)if((o=r[i]).type===c.type&&o.name===c.name)return c.value},dispatch:function(t,e){return this.each(("function"==typeof e?function(t,e){return function(){return W(this,t,e.apply(this,arguments))}}:function(t,e){return function(){return W(this,t,e)}})(t,e))}};var U=function(t){return"string"==typeof t?new V([[document.querySelector(t)]],[document.documentElement]):new V([[t]],F)},G=function(t,e,n){arguments.length<3&&(n=e,e=x().changedTouches);for(var i,o=0,r=e?e.length:0;o<r;++o)if((i=e[o]).identifier===n)return b(t,i);return null},J={value:function(){}};function $(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i)throw new Error("illegal type: "+t);i[t]=[]}return new Z(i)}function Z(t){this._=t}function Q(t,e){for(var n,i=0,o=t.length;i<o;++i)if((n=t[i]).name===e)return n.value}function K(t,e,n){for(var i=0,o=t.length;i<o;++i)if(t[i].name===e){t[i]=J,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}Z.prototype=$.prototype={constructor:Z,on:function(t,e){var n,i=this._,o=function(t,e){return t.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");if(i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}(t+"",i),r=-1,a=o.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++r<a;)if(n=(t=o[r]).type)i[n]=K(i[n],t.name,e);else if(null==e)for(n in i)i[n]=K(i[n],t.name,null);return this}for(;++r<a;)if((n=(t=o[r]).type)&&(n=Q(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Z(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,o=new Array(n),r=0;r<n;++r)o[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(r=0,n=(i=this._[t]).length;r<n;++r)i[r].value.apply(e,o)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],o=0,r=i.length;o<r;++o)i[o].value.apply(e,n)}};var tt=$;function et(){p.stopImmediatePropagation()}var nt=function(){p.preventDefault(),p.stopImmediatePropagation()},it=function(t){var e=t.document.documentElement,n=U(t).on("dragstart.drag",nt,!0);"onselectstart"in e?n.on("selectstart.drag",nt,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")},ot=function(t){return function(){return t}};function rt(t,e,n,i,o,r,a,s,c,u){this.target=t,this.type=e,this.subject=n,this.identifier=i,this.active=o,this.x=r,this.y=a,this.dx=s,this.dy=c,this._=u}function at(){return!p.button}function st(){return this.parentNode}function ct(t){return null==t?{x:p.x,y:p.y}:t}rt.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var ut=function(){var t,e,n=at,i=st,o=ct,r={},a=tt("start","drag","end"),s=0;function c(t){t.on("mousedown.drag",u).on("touchstart.drag",f).on("touchmove.drag",d).on("touchend.drag touchcancel.drag",_).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function u(){if(!e&&n.apply(this,arguments)){var o=y("mouse",i.apply(this,arguments),w,this,arguments);o&&(U(p.view).on("mousemove.drag",l,!0).on("mouseup.drag",h,!0),it(p.view),et(),t=!1,o("start"))}}function l(){nt(),t=!0,r.mouse("drag")}function h(){U(p.view).on("mousemove.drag mouseup.drag",null),function(t,e){var n=t.document.documentElement,i=U(t).on("dragstart.drag",null);e&&(i.on("click.drag",nt,!0),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}(p.view,t),nt(),r.mouse("end")}function f(){if(n.apply(this,arguments)){var t,e,o=p.changedTouches,r=i.apply(this,arguments),a=o.length;for(t=0;t<a;++t)(e=y(o[t].identifier,r,G,this,arguments))&&(et(),e("start"))}}function d(){var t,e,n=p.changedTouches,i=n.length;for(t=0;t<i;++t)(e=r[n[t].identifier])&&(nt(),e("drag"))}function _(){var t,n,i=p.changedTouches,o=i.length;for(e&&clearTimeout(e),e=setTimeout(function(){e=null},500),t=0;t<o;++t)(n=r[i[t].identifier])&&(et(),n("end"))}function y(t,e,n,i,u){var l,h,f,d=n(e,t),_=a.copy();if(m(new rt(c,"beforestart",l,t,s,d[0],d[1],0,0,_),function(){return null!=(p.subject=l=o.apply(i,u))&&(h=l.x-d[0]||0,f=l.y-d[1]||0,!0)}))return function o(a){var p,y=d;switch(a){case"start":r[t]=o,p=s++;break;case"end":delete r[t],--s;case"drag":d=n(e,t),p=s}m(new rt(c,a,l,t,p,d[0]+h,d[1]+f,d[0]-y[0],d[1]-y[1],_),_.apply,_,[a,i,u])}}return c.filter=function(t){return arguments.length?(n="function"==typeof t?t:ot(!!t),c):n},c.container=function(t){return arguments.length?(i="function"==typeof t?t:ot(t),c):i},c.subject=function(t){return arguments.length?(o="function"==typeof t?t:ot(t),c):o},c.on=function(){var t=a.on.apply(a,arguments);return t===a?c:t},c},lt=Math.PI,ht=2*lt,ft=ht-1e-6;function dt(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function pt(){return new dt}dt.prototype=pt.prototype={constructor:dt,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(t,e,n,i,o,r){this._+="C"+ +t+","+ +e+","+ +n+","+ +i+","+(this._x1=+o)+","+(this._y1=+r)},arcTo:function(t,e,n,i,o){t=+t,e=+e,n=+n,i=+i,o=+o;var r=this._x1,a=this._y1,s=n-t,c=i-e,u=r-t,l=a-e,h=u*u+l*l;if(o<0)throw new Error("negative radius: "+o);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(h>1e-6)if(Math.abs(l*s-c*u)>1e-6&&o){var f=n-r,d=i-a,p=s*s+c*c,_=f*f+d*d,y=Math.sqrt(p),v=Math.sqrt(h),g=o*Math.tan((lt-Math.acos((p+h-_)/(2*y*v)))/2),m=g/v,x=g/y;Math.abs(m-1)>1e-6&&(this._+="L"+(t+m*u)+","+(e+m*l)),this._+="A"+o+","+o+",0,0,"+ +(l*f>u*d)+","+(this._x1=t+x*s)+","+(this._y1=e+x*c)}else this._+="L"+(this._x1=t)+","+(this._y1=e)},arc:function(t,e,n,i,o,r){t=+t,e=+e;var a=(n=+n)*Math.cos(i),s=n*Math.sin(i),c=t+a,u=e+s,l=1^r,h=r?i-o:o-i;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+c+","+u:(Math.abs(this._x1-c)>1e-6||Math.abs(this._y1-u)>1e-6)&&(this._+="L"+c+","+u),n&&(h<0&&(h=h%ht+ht),h>ft?this._+="A"+n+","+n+",0,1,"+l+","+(t-a)+","+(e-s)+"A"+n+","+n+",0,1,"+l+","+(this._x1=c)+","+(this._y1=u):h>1e-6&&(this._+="A"+n+","+n+",0,"+ +(h>=lt)+","+l+","+(this._x1=t+n*Math.cos(o))+","+(this._y1=e+n*Math.sin(o))))},rect:function(t,e,n,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};var _t=pt,yt=function(t){return function(){return t}},vt=1e-12,gt=Math.PI,mt=gt/2,xt=2*gt;function bt(t){return t.innerRadius}function wt(t){return t.outerRadius}function Mt(t){return t.startAngle}function jt(t){return t.endAngle}function kt(t){return t&&t.padAngle}function At(t){return t>=1?mt:t<=-1?-mt:Math.asin(t)}function Ot(t,e,n,i,o,r,a){var s=t-n,c=e-i,u=(a?r:-r)/Math.sqrt(s*s+c*c),l=u*c,h=-u*s,f=t+l,d=e+h,p=n+l,_=i+h,y=(f+p)/2,v=(d+_)/2,g=p-f,m=_-d,x=g*g+m*m,b=o-r,w=f*_-p*d,M=(m<0?-1:1)*Math.sqrt(Math.max(0,b*b*x-w*w)),j=(w*m-g*M)/x,k=(-w*g-m*M)/x,A=(w*m+g*M)/x,O=(-w*g+m*M)/x,S=j-y,T=k-v,E=A-y,P=O-v;return S*S+T*T>E*E+P*P&&(j=A,k=O),{cx:j,cy:k,x01:-l,y01:-h,x11:j*(o/b-1),y11:k*(o/b-1)}}function St(t){this._context=t}St.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var Tt=function(t){return new St(t)};function Et(t){return t[0]}function Pt(t){return t[1]}function Nt(t){this._curve=t}!function(t){function e(e){return new Nt(t(e))}e._curve=t}(Tt),Nt.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}},Math.sqrt(1/3);Math.sin(gt/10),Math.sin(7*gt/10);var Ct=(Math.sin(xt/10),Math.cos(xt/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12),function(){});function Yt(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function Rt(t){this._context=t}function Bt(t,e){this._basis=new Rt(t),this._beta=e}function Xt(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function It(t,e){this._context=t,this._k=(1-e)/6}function Lt(t,e){this._context=t,this._k=(1-e)/6}function Dt(t,e){this._context=t,this._k=(1-e)/6}function qt(t,e,n){var i=t._x1,o=t._y1,r=t._x2,a=t._y2;if(t._l01_a>vt){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,c=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/c,o=(o*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/c}if(t._l23_a>vt){var u=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,l=3*t._l23_a*(t._l23_a+t._l12_a);r=(r*u+t._x1*t._l23_2a-e*t._l12_2a)/l,a=(a*u+t._y1*t._l23_2a-n*t._l12_2a)/l}t._context.bezierCurveTo(i,o,r,a,t._x2,t._y2)}function zt(t,e){this._context=t,this._alpha=e}Rt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Yt(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Yt(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},Bt.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var i,o=t[0],r=e[0],a=t[n]-o,s=e[n]-r,c=-1;++c<=n;)i=c/n,this._basis.point(this._beta*t[c]+(1-this._beta)*(o+i*a),this._beta*e[c]+(1-this._beta)*(r+i*s));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}},function t(e){function n(t){return 1===e?new Rt(t):new Bt(t,e)}return n.beta=function(e){return t(+e)},n}(.85),It.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Xt(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:Xt(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function n(t){return new It(t,e)}return n.tension=function(e){return t(+e)},n}(0),Lt.prototype={areaStart:Ct,areaEnd:Ct,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Xt(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function n(t){return new Lt(t,e)}return n.tension=function(e){return t(+e)},n}(0),Dt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Xt(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function n(t){return new Dt(t,e)}return n.tension=function(e){return t(+e)},n}(0),zt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:qt(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Ht=function t(e){function n(t){return e?new zt(t,e):new It(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Wt(t,e){this._context=t,this._alpha=e}function Ft(t,e){this._context=t,this._alpha=e}function Vt(t){return t<0?-1:1}function Ut(t,e,n){var i=t._x1-t._x0,o=e-t._x1,r=(t._y1-t._y0)/(i||o<0&&-0),a=(n-t._y1)/(o||i<0&&-0),s=(r*o+a*i)/(i+o);return(Vt(r)+Vt(a))*Math.min(Math.abs(r),Math.abs(a),.5*Math.abs(s))||0}function Gt(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function Jt(t,e,n){var i=t._x0,o=t._y0,r=t._x1,a=t._y1,s=(r-i)/3;t._context.bezierCurveTo(i+s,o+s*e,r-s,a-s*n,r,a)}function $t(t){this._context=t}function Zt(t){this._context=t}Wt.prototype={areaStart:Ct,areaEnd:Ct,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:qt(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function n(t){return e?new Wt(t,e):new Lt(t,0)}return n.alpha=function(e){return t(+e)},n}(.5),Ft.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:qt(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function n(t){return e?new Ft(t,e):new Dt(t,0)}return n.alpha=function(e){return t(+e)},n}(.5),$t.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Jt(this,this._t0,Gt(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,Jt(this,Gt(this,n=Ut(this,t,e)),n);break;default:Jt(this,this._t0,n=Ut(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(function(t){this._context=new Zt(t)}.prototype=Object.create($t.prototype)).point=function(t,e){$t.prototype.point.call(this,e,t)},Zt.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,i,o,r){this._context.bezierCurveTo(e,t,i,n,r,o)}},Array.prototype.slice,n.d(e,"annotation",function(){return Ne}),n.d(e,"annotationTypeBase",function(){return ye}),n.d(e,"annotationLabel",function(){return me}),n.d(e,"annotationCallout",function(){return xe}),n.d(e,"annotationCalloutCurve",function(){return we}),n.d(e,"annotationCalloutElbow",function(){return be}),n.d(e,"annotationCalloutCircle",function(){return je}),n.d(e,"annotationCalloutRect",function(){return ke}),n.d(e,"annotationXYThreshold",function(){return Oe}),n.d(e,"annotationBadge",function(){return Me}),n.d(e,"annotationCustomType",function(){return ve});var Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kt=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},te=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ee=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},ne=function t(e,n,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,i)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(i):void 0},ie=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},oe=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},re=function(){function t(e){var n=e.x,i=void 0===n?0:n,o=e.y,r=void 0===o?0:o,a=e.nx,s=e.ny,c=e.dy,u=void 0===c?0:c,l=e.dx,h=void 0===l?0:l,f=e.color,d=void 0===f?"grey":f,p=e.data,_=e.type,y=e.subject,v=e.connector,g=e.note,m=e.disable,x=e.id,b=e.className;Kt(this,t),this._dx=void 0!==a?a-i:h,this._dy=void 0!==s?s-r:u,this._x=i,this._y=r,this._color=d,this.id=x,this._className=b||"",this.type=_||"",this.data=p,this.note=g||{},this.connector=v||{},this.subject=y||{},this.disable=m||[]}return te(t,[{key:"updatePosition",value:function(){this.type.setPosition&&(this.type.setPosition(),this.type.subject&&0!==this.type.subject.selectAll(":not(.handle)").nodes().length&&this.type.redrawSubject())}},{key:"updateOffset",value:function(){this.type.setOffset&&(this.type.setOffset(),0!==this.type.connector.selectAll(":not(.handle)").nodes().length&&this.type.redrawConnector(),this.type.redrawNote())}},{key:"className",get:function(){return this._className},set:function(t){this._className=t,this.type.setClassName&&this.type.setClassName()}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this.updatePosition()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this.updatePosition()}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this.updatePosition()}},{key:"dx",get:function(){return this._dx},set:function(t){this._dx=t,this.updateOffset()}},{key:"dy",get:function(){return this._dy},set:function(t){this._dy=t,this.updateOffset()}},{key:"nx",set:function(t){this._dx=t-this._x,this.updateOffset()}},{key:"ny",set:function(t){this._dy=t-this._y,this.updateOffset()}},{key:"offset",get:function(){return{x:this._dx,y:this._dy}},set:function(t){var e=t.x,n=t.y;this._dx=e,this._dy=n,this.updateOffset()}},{key:"position",get:function(){return{x:this._x,y:this._y}},set:function(t){var e=t.x,n=t.y;this._x=e,this._y=n,this.updatePosition()}},{key:"translation",get:function(){return{x:this._x+this._dx,y:this._y+this._dy}}},{key:"json",get:function(){var t={x:this._x,y:this._y,dx:this._dx,dy:this._dy};return this.data&&Object.keys(this.data).length>0&&(t.data=this.data),this.type&&(t.type=this.type),this._className&&(t.className=this._className),Object.keys(this.connector).length>0&&(t.connector=this.connector),Object.keys(this.subject).length>0&&(t.subject=this.subject),Object.keys(this.note).length>0&&(t.note=this.note),t}}]),t}(),ae=function(){function t(e){var n=e.annotations,i=e.accessors,o=e.accessorsInverse;Kt(this,t),this.accessors=i,this.accessorsInverse=o,this.annotations=n}return te(t,[{key:"clearTypes",value:function(t){this.annotations.forEach(function(e){e.type=void 0,e.subject=t&&t.subject||e.subject,e.connector=t&&t.connector||e.connector,e.note=t&&t.note||e.note})}},{key:"setPositionWithAccessors",value:function(){var t=this;this.annotations.forEach(function(e){e.type.setPositionWithAccessors(t.accessors)})}},{key:"editMode",value:function(t){this.annotations.forEach(function(e){e.type&&(e.type.editMode=t,e.type.updateEditMode())})}},{key:"updateDisable",value:function(t){this.annotations.forEach(function(e){e.disable=t,e.type&&t.forEach(function(t){e.type[t]&&(e.type[t].remove&&e.type[t].remove(),e.type[t]=void 0)})})}},{key:"updateTextWrap",value:function(t){this.annotations.forEach(function(e){e.type&&e.type.updateTextWrap&&e.type.updateTextWrap(t)})}},{key:"updateText",value:function(){this.annotations.forEach(function(t){t.type&&t.type.drawText&&t.type.drawText()})}},{key:"updateNotePadding",value:function(t){this.annotations.forEach(function(e){e.type&&(e.type.notePadding=t)})}},{key:"json",get:function(){var t=this;return this.annotations.map(function(e){var n=e.json;return t.accessorsInverse&&e.data&&(n.data={},Object.keys(t.accessorsInverse).forEach(function(i){n.data[i]=t.accessorsInverse[i]({x:e.x,y:e.y})})),n})}},{key:"noteNodes",get:function(){return this.annotations.map(function(t){return ee({},t.type.getNoteBBoxOffset(),{positionX:t.x,positionY:t.y})})}}]),t}(),se=function(t,e){return"dynamic"!==t&&"left"!==t&&"right"!==t||(t=e<0?"top":"bottom"),t},ce=function(t,e){return"dynamic"!==t&&"top"!==t&&"bottom"!==t||(t=e<0?"right":"left"),t},ue=["topBottom","top","bottom"],le=["leftRight","left","right"],he=function(t){var e=t.data,n=t.curve,i=void 0===n?Tt:n,o=t.canvasContext,r=t.className,a=t.classID,s=function(){var t=Et,e=Pt,n=yt(!0),i=null,o=Tt,r=null;function a(a){var s,c,u,l=a.length,h=!1;for(null==i&&(r=o(u=_t())),s=0;s<=l;++s)!(s<l&&n(c=a[s],s,a))===h&&((h=!h)?r.lineStart():r.lineEnd()),h&&r.point(+t(c,s,a),+e(c,s,a));if(u)return r=null,u+""||null}return a.x=function(e){return arguments.length?(t="function"==typeof e?e:yt(+e),a):t},a.y=function(t){return arguments.length?(e="function"==typeof t?t:yt(+t),a):e},a.defined=function(t){return arguments.length?(n="function"==typeof t?t:yt(!!t),a):n},a.curve=function(t){return arguments.length?(o=t,null!=i&&(r=o(i)),a):o},a.context=function(t){return arguments.length?(null==t?i=r=null:r=o(i=t),a):i},a}().curve(i),c={type:"path",className:r,classID:a,data:e};return o?(s.context(o),c.pathMethods=s):c.attrs={d:s(e)},c},fe=function(t){var e=t.data,n=t.canvasContext,i={type:"path",className:t.className,classID:t.classID,data:e},o=function(){var t=bt,e=wt,n=yt(0),i=null,o=Mt,r=jt,a=kt,s=null;function c(){var c,u,l=+t.apply(this,arguments),h=+e.apply(this,arguments),f=o.apply(this,arguments)-mt,d=r.apply(this,arguments)-mt,p=Math.abs(d-f),_=d>f;if(s||(s=c=_t()),h<l&&(u=h,h=l,l=u),h>vt)if(p>xt-vt)s.moveTo(h*Math.cos(f),h*Math.sin(f)),s.arc(0,0,h,f,d,!_),l>vt&&(s.moveTo(l*Math.cos(d),l*Math.sin(d)),s.arc(0,0,l,d,f,_));else{var y,v,g=f,m=d,x=f,b=d,w=p,M=p,j=a.apply(this,arguments)/2,k=j>vt&&(i?+i.apply(this,arguments):Math.sqrt(l*l+h*h)),A=Math.min(Math.abs(h-l)/2,+n.apply(this,arguments)),O=A,S=A;if(k>vt){var T=At(k/l*Math.sin(j)),E=At(k/h*Math.sin(j));(w-=2*T)>vt?(x+=T*=_?1:-1,b-=T):(w=0,x=b=(f+d)/2),(M-=2*E)>vt?(g+=E*=_?1:-1,m-=E):(M=0,g=m=(f+d)/2)}var P=h*Math.cos(g),N=h*Math.sin(g),C=l*Math.cos(b),Y=l*Math.sin(b);if(A>vt){var R=h*Math.cos(m),B=h*Math.sin(m),X=l*Math.cos(x),I=l*Math.sin(x);if(p<gt){var L=w>vt?function(t,e,n,i,o,r,a,s){var c=X-P,u=I-N,l=C-R,h=Y-B,f=(l*(N-B)-h*(P-R))/(h*c-l*u);return[P+f*c,N+f*u]}():[C,Y],D=P-L[0],q=N-L[1],z=R-L[0],H=B-L[1],W=1/Math.sin(Math.acos((D*z+q*H)/(Math.sqrt(D*D+q*q)*Math.sqrt(z*z+H*H)))/2),F=Math.sqrt(L[0]*L[0]+L[1]*L[1]);O=Math.min(A,(l-F)/(W-1)),S=Math.min(A,(h-F)/(W+1))}}M>vt?S>vt?(y=Ot(X,I,P,N,h,S,_),v=Ot(R,B,C,Y,h,S,_),s.moveTo(y.cx+y.x01,y.cy+y.y01),S<A?s.arc(y.cx,y.cy,S,Math.atan2(y.y01,y.x01),Math.atan2(v.y01,v.x01),!_):(s.arc(y.cx,y.cy,S,Math.atan2(y.y01,y.x01),Math.atan2(y.y11,y.x11),!_),s.arc(0,0,h,Math.atan2(y.cy+y.y11,y.cx+y.x11),Math.atan2(v.cy+v.y11,v.cx+v.x11),!_),s.arc(v.cx,v.cy,S,Math.atan2(v.y11,v.x11),Math.atan2(v.y01,v.x01),!_))):(s.moveTo(P,N),s.arc(0,0,h,g,m,!_)):s.moveTo(P,N),l>vt&&w>vt?O>vt?(y=Ot(C,Y,R,B,l,-O,_),v=Ot(P,N,X,I,l,-O,_),s.lineTo(y.cx+y.x01,y.cy+y.y01),O<A?s.arc(y.cx,y.cy,O,Math.atan2(y.y01,y.x01),Math.atan2(v.y01,v.x01),!_):(s.arc(y.cx,y.cy,O,Math.atan2(y.y01,y.x01),Math.atan2(y.y11,y.x11),!_),s.arc(0,0,l,Math.atan2(y.cy+y.y11,y.cx+y.x11),Math.atan2(v.cy+v.y11,v.cx+v.x11),_),s.arc(v.cx,v.cy,O,Math.atan2(v.y11,v.x11),Math.atan2(v.y01,v.x01),!_))):s.arc(0,0,l,b,x,_):s.lineTo(C,Y)}else s.moveTo(0,0);if(s.closePath(),c)return s=null,c+""||null}return c.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,i=(+o.apply(this,arguments)+ +r.apply(this,arguments))/2-gt/2;return[Math.cos(i)*n,Math.sin(i)*n]},c.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:yt(+e),c):t},c.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:yt(+t),c):e},c.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:yt(+t),c):n},c.padRadius=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:yt(+t),c):i},c.startAngle=function(t){return arguments.length?(o="function"==typeof t?t:yt(+t),c):o},c.endAngle=function(t){return arguments.length?(r="function"==typeof t?t:yt(+t),c):r},c.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:yt(+t),c):a},c.context=function(t){return arguments.length?(s=null==t?null:t,c):s},c}().innerRadius(e.innerRadius||0).outerRadius(e.outerRadius||e.radius||2).startAngle(e.startAngle||0).endAngle(e.endAngle||2*Math.PI);return n?(o.context(n),i.pathMethods=lineGen):i.attrs={d:o()},i},de=function(t){var e=t.type,n=t.subjectType,i=e.annotation,o=i.position,r=i.x-o.x,a=r+i.dx,s=i.y-o.y,c=s+i.dy,u=i.subject;if("circle"===n&&(u.outerRadius||u.radius)){var l=Math.sqrt((r-a)*(r-a)+(s-c)*(s-c)),h=Math.asin(-c/l),f=u.outerRadius||u.radius+(u.radiusPadding||0);r=Math.abs(Math.cos(h)*f)*(a<0?-1:1),s=Math.abs(Math.sin(h)*f)*(c<0?-1:1)}if("rect"===n){var d=u.width,p=u.height;(d>0&&i.dx>0||d<0&&i.dx<0)&&(r=Math.abs(d)>Math.abs(i.dx)?d/2:d),(p>0&&i.dy>0||p<0&&i.dy<0)&&(s=Math.abs(p)>Math.abs(i.dy)?p/2:p),r===d/2&&s===p/2&&(r=a,s=c)}return[[r,s],[a,c]]},pe=function(t){var e=t.type,n=t.connectorData,i=t.subjectType;n||(n={}),n.points&&"number"!=typeof n.points||(n.points=_e(e.annotation.offset,n.points)),n.curve||(n.curve=Ht);var o=[];if(e.editMode){var r=n.points.map(function(t,e){return ee({},function(t){var e=t.cx,n=t.cy;return{move:{x:void 0===e?0:e,y:void 0===n?0:n}}}({cx:t[0],cy:t[1]}),{index:e})});o=e.mapHandles(r.map(function(t){return ee({},t.move,{drag:function(t){n.points[t][0]+=p.dx,n.points[t][1]+=p.dy,e.redrawConnector()}.bind(e,t.index)})}))}var a=de({type:e,subjectType:i});return a=[a[0]].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(n.points),[a[1]]),{components:[he({data:a,curve:n.curve,className:"connector"})],handles:o}},_e=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=t.x/(e+1),i=t.y/(e+1),o=[],r=1;r<=e;r++)o.push([n*r+r%2*20,i*r-r%2*20]);return o},ye=function(){function t(e){var n=e.a,i=e.annotation,o=e.editMode,r=e.dispatcher,a=e.notePadding,s=e.accessors;if(Kt(this,t),this.a=n,this.note=-1===i.disable.indexOf("note")&&n.select("g.annotation-note"),this.noteContent=this.note&&n.select("g.annotation-note-content"),this.connector=-1===i.disable.indexOf("connector")&&n.select("g.annotation-connector"),this.subject=-1===i.disable.indexOf("subject")&&n.select("g.annotation-subject"),this.dispatcher=r,r){var c=Te.bind(null,r,i);c({component:this.note,name:"note"}),c({component:this.connector,name:"connector"}),c({component:this.subject,name:"subject"})}this.annotation=i,this.editMode=i.editMode||o,this.notePadding=void 0!==a?a:3,this.offsetCornerX=0,this.offsetCornerY=0,s&&i.data&&this.init(s)}return te(t,[{key:"init",value:function(t){this.annotation.x||this.mapX(t),this.annotation.y||this.mapY(t)}},{key:"mapY",value:function(t){t.y&&(this.annotation.y=t.y(this.annotation.data))}},{key:"mapX",value:function(t){t.x&&(this.annotation.x=t.x(this.annotation.data))}},{key:"updateEditMode",value:function(){this.a.selectAll("circle.handle").remove()}},{key:"drawOnSVG",value:function(t,e){var n=this;Array.isArray(e)||(e=[e]),e.filter(function(t){return t}).forEach(function(e){var i=e.type,o=e.className,r=e.attrs,a=e.handles,s=e.classID;if("handle"===i)!function(t){var e=t.group,n=t.handles,i=t.r,o=void 0===i?10:i,r=e.selectAll("circle.handle").data(n);r.enter().append("circle").attr("class","handle").attr("fill","grey").attr("fill-opacity",.1).attr("cursor","move").attr("stroke-dasharray",5).attr("stroke","grey").call(ut().container(U("g.annotations").node()).on("start",function(t){return t.start&&t.start(t)}).on("drag",function(t){return t.drag&&t.drag(t)}).on("end",function(t){return t.end&&t.end(t)})),e.selectAll("circle.handle").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",function(t){return t.r||o}).attr("class",function(t){return"handle "+(t.className||"")}),r.exit().remove()}({group:t,r:r&&r.r,handles:a});else{Se(t,[n.annotation],i,o,s);for(var c=t.select(i+"."+(s||o)),u=Object.keys(r),l=[],h=c.node().attributes,f=h.length-1;f>=0;f--){var d=h[f].name;-1===u.indexOf(d)&&"class"!==d&&l.push(d)}u.forEach(function(t){"text"===t?c.text(r[t]):c.attr(t,r[t])}),l.forEach(function(t){return c.attr(t,null)})}})}},{key:"getNoteBBox",value:function(){return Pe(this.note,".annotation-note-content text")}},{key:"getNoteBBoxOffset",value:function(){var t=Pe(this.note,".annotation-note-content"),e=this.noteContent.attr("transform").split(/\(|\,|\)/g);return t.offsetCornerX=parseFloat(e[1])+this.annotation.dx,t.offsetCornerY=parseFloat(e[2])+this.annotation.dy,t.offsetX=this.annotation.dx,t.offsetY=this.annotation.dy,t}},{key:"drawSubject",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.annotation.subject,i=e.type,o={type:this,subjectData:n},r={};"circle"===i?r=function(t){var e=t.subjectData,n=t.type;e.radius||e.outerRadius||(e.radius=20);var i=[],o=fe({data:e,className:"subject"});if(n.editMode){var r=function(t){var e=t.cx,n=void 0===e?0:e,i=t.cy,o=void 0===i?0:i,r=t.r1,a=t.r2,s=t.padding,c={move:{x:n,y:o}};return void 0!==r&&(c.r1={x:n+r/Math.sqrt(2),y:o+r/Math.sqrt(2)}),void 0!==a&&(c.r2={x:n+a/Math.sqrt(2),y:o+a/Math.sqrt(2)}),void 0!==s&&(c.padding={x:n+r+s,y:o}),c}({r1:o.data.outerRadius||o.data.radius,r2:o.data.innerRadius,padding:e.radiusPadding}),a=function(t){var i=e[t]+p.dx*Math.sqrt(2);e[t]=i,n.redrawSubject(),n.redrawConnector()},s=[ee({},r.r1,{drag:a.bind(n,void 0!==e.outerRadius?"outerRadius":"radius")})];e.innerRadius&&s.push(ee({},r.r2,{drag:a.bind(n,"innerRadius")})),i=n.mapHandles(s)}return o.attrs["fill-opacity"]=0,{components:[o],handles:i}}(o):"rect"===i?r=function(t){var e=t.subjectData,n=t.type;e.width||(e.width=100),e.height||(e.height=100);var i=[],o=e.width,r=e.height,a=he({data:[[0,0],[o,0],[o,r],[0,r],[0,0]],className:"subject"});if(n.editMode){var s=[{x:o,y:r/2,drag:function(){e.width=p.x,n.redrawSubject(),n.redrawConnector()}.bind(n)},{x:o/2,y:r,drag:function(){e.height=p.y,n.redrawSubject(),n.redrawConnector()}.bind(n)}];i=n.mapHandles(s)}return a.attrs["fill-opacity"]=.1,{components:[a],handles:i}}(o):"threshold"===i?r=function(t){var e=t.subjectData,n=t.type.annotation.position,i=(void 0!==e.x1?e.x1:n.x)-n.x,o=(void 0!==e.x2?e.x2:n.x)-n.x,r=(void 0!==e.y1?e.y1:n.y)-n.y,a=(void 0!==e.y2?e.y2:n.y)-n.y;return{components:[he({data:[[i,r],[o,a]],className:"subject"})]}}(o):"badge"===i&&(r=function(t){var e=t.subjectData,n=void 0===e?{}:e,i=t.type,o=void 0===i?{}:i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=o.typeSettings&&o.typeSettings.subject;n.radius||(a&&a.radius?n.radius=a.radius:n.radius=14),n.x||a&&a.x&&(n.x=a.x),n.y||a&&a.y&&(n.y=a.y);var s=[],c=[],u=n.radius,l=.7*u,h=0,f=0,d=Math.sqrt(2)*u,_={xleftcorner:-u,xrightcorner:u,ytopcorner:-u,ybottomcorner:u,xleft:-d,xright:d,ytop:-d,ybottom:d};n.x&&!n.y?h=_["x"+n.x]:n.y&&!n.x?f=_["y"+n.y]:n.x&&n.y&&(h=_["x"+n.x+"corner"],f=_["y"+n.y+"corner"]);var y="translate("+h+", "+f+")",v=fe({className:"subject",data:{radius:u}});v.attrs.transform=y,v.attrs.fill=r.color,v.attrs["stroke-linecap"]="round",v.attrs["stroke-width"]="3px";var g=fe({className:"subject-ring",data:{outerRadius:u,innerRadius:l}});g.attrs.transform=y,g.attrs["stroke-width"]="3px",g.attrs.fill="white";var m=void 0;if(h&&f||!h&&!f)m=he({className:"subject-pointer",data:[[0,0],[h||0,0],[0,f||0],[0,0]]});else if(h||f){var x=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t&&t/Math.sqrt(2)/Math.sqrt(2)||e*u/Math.sqrt(2)};m=he({className:"subject-pointer",data:[[0,0],[x(h),x(f)],[x(h,-1),x(f,-1)],[0,0]]})}if(m&&(m.attrs.fill=r.color,m.attrs["stroke-linecap"]="round",m.attrs["stroke-width"]="3px",c.push(m)),o.editMode){var b={x:2*h,y:2*f,drag:function(){n.x=p.x<2*-u?"left":p.x>2*u?"right":void 0,n.y=p.y<2*-u?"top":p.y>2*u?"bottom":void 0,o.redrawSubject()}.bind(o)};b.x||b.y||(b.y=-u),s=o.mapHandles([b])}var w=void 0;return n.text&&(w={type:"text",className:"badge-text",attrs:{fill:"white",stroke:"none","font-size":".7em",text:n.text,"text-anchor":"middle",dy:".25em",x:h,y:f}}),c.push(v),c.push(g),c.push(w),{components:c,handles:s}}(o,this.annotation));var a=r,s=a.components,c=void 0===s?[]:s,u=a.handles,l=void 0===u?[]:u;return c.forEach(function(e){e&&e.attrs&&!e.attrs.stroke&&(e.attrs.stroke=t.annotation.color)}),this.editMode&&(l=l.concat(this.mapHandles([{drag:this.dragSubject.bind(this)}])),c.push({type:"handle",handles:l})),c}},{key:"drawConnector",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.annotation.connector,i=n.type||e.type,o={type:this,connectorData:n};o.subjectType=this.typeSettings&&this.typeSettings.subject&&this.typeSettings.subject.type;var r="curve"===i?pe(o):"elbow"===i?function(t){var e=t.type,n=t.subjectType,i=e.annotation,o=i.position,r=i.x-o.x,a=r+i.dx,s=i.y-o.y,c=s+i.dy,u=i.subject;if("rect"===n){var l=u.width,h=u.height;(l>0&&i.dx>0||l<0&&i.dx<0)&&(r=Math.abs(l)>Math.abs(i.dx)?l/2:l),(h>0&&i.dy>0||h<0&&i.dy<0)&&(s=Math.abs(h)>Math.abs(i.dy)?h/2:h),r===l/2&&s===h/2&&(r=a,s=c)}var f=[[r,s],[a,c]],d=c-s,p=a-r,_=a,y=c,v=c<s&&a>r||a<r&&c>s?-1:1;if(Math.abs(p)<Math.abs(d)?(_=a,y=s+p*v):(y=c,_=r+d*v),"circle"===n&&(u.outerRadius||u.radius)){var g=(u.outerRadius||u.radius)+(u.radiusPadding||0),m=g/Math.sqrt(2);if(Math.abs(p)>m&&Math.abs(d)>m)f=[[r=m*(a<0?-1:1),s=m*(c<0?-1:1)],[_,y],[a,c]];else if(Math.abs(p)>Math.abs(d)){var x=Math.asin(-c/g);f=[[r=Math.abs(Math.cos(x)*g)*(a<0?-1:1),c],[a,c]]}else{var b=Math.acos(a/g);f=[[a,s=Math.abs(Math.sin(b)*g)*(c<0?-1:1)],[a,c]]}}else f=[[r,s],[_,y],[a,c]];return{components:[he({data:f,className:"connector"})]}}(o):function(t){var e=de(o);return{components:[he({data:e,className:"connector"})]}}(),a=r.components,s=void 0===a?[]:a,c=r.handles,u=void 0===c?[]:c,l=s[0];l&&(l.attrs.stroke=this.annotation.color,l.attrs.fill="none");var h=n.end||e.end,f={};if("arrow"===h){var d=l.data[1],p=l.data[0];Math.sqrt(Math.pow(d[0]-p[0],2)+Math.pow(d[1]-p[1],2))<5&&l.data[2]&&(d=l.data[2]),f=function(t){var e=t.annotation,n=t.start,i=t.end,o=t.scale,r=void 0===o?1:o,a=e.position;n=n?[-i[0]+n[0],-i[1]+n[1]]:[e.dx,e.dy],i||(i=[e.x-a.x,e.y-a.y]);var s=i[0],c=i[1],u=n[0],l=n[1],h=10*r,f=16/180*Math.PI,d=Math.atan(l/u);u<0&&(d+=Math.PI);var p=[[s,c],[Math.cos(d+f)*h+s,Math.sin(d+f)*h+c],[Math.cos(d-f)*h+s,Math.sin(d-f)*h+c],[s,c]];return{components:[he({data:p,className:"connector-end connector-arrow",classID:"connector-end"})]}}({annotation:this.annotation,start:d,end:p,scale:n.endScale})}else"dot"===h?f=function(t){var e=t.line,n=t.scale,i=void 0===n?1:n,o=fe({className:"connector-end connector-dot",classID:"connector-end",data:{radius:3*Math.sqrt(i)}});return o.attrs.transform="translate("+e.data[0][0]+", "+e.data[0][1]+")",{components:[o]}}({line:l,scale:n.endScale}):h&&"none"!==h||this.connector&&this.connector.select(".connector-end").remove();return f.components&&(f.components.forEach(function(e){e.attrs.fill=t.annotation.color,e.attrs.stroke=t.annotation.color}),s=s.concat(f.components)),this.editMode&&0!==u.length&&s.push({type:"handle",handles:u}),s}},{key:"drawNote",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.annotation.note,i=n.align||e.align||"dynamic",o={bbox:e.bbox,align:i,offset:this.annotation.offset},r=n.lineType||e.lineType,a={};"vertical"===r?a=function(t){var e=t.align,n=t.x,i=void 0===n?0:n,o=t.y,r=void 0===o?0:o,a=t.bbox;"top"===(e=se(e,t.offset.y))?r-=a.height:"middle"===e&&(r-=a.height/2);var s=[[i,r],[i,r+a.height]];return{components:[he({data:s,className:"note-line"})]}}(o):"horizontal"===r&&(a=function(t){var e=t.align,n=t.x,i=void 0===n?0:n,o=t.y,r=void 0===o?0:o,a=t.bbox;"right"===(e=ce(e,t.offset.x))?i-=a.width:"middle"===e&&(i-=a.width/2);var s=[[i,r],[i+a.width,r]];return{components:[he({data:s,className:"note-line"})]}}(o));var s=a,c=s.components,u=void 0===c?[]:c,l=s.handles,h=void 0===l?[]:l;if(u.forEach(function(e){e.attrs.stroke=t.annotation.color}),this.editMode){h=this.mapHandles([{x:0,y:0,drag:this.dragNote.bind(this)}]),u.push({type:"handle",handles:h});var f=this.dragNote.bind(this),d=this.dragstarted.bind(this),p=this.dragended.bind(this);this.note.call(ut().container(U("g.annotations").node()).on("start",function(t){return d(t)}).on("drag",function(t){return f(t)}).on("end",function(t){return p(t)}))}else this.note.on("mousedown.drag",null);return u}},{key:"drawNoteContent",value:function(t){var e=this.annotation.note,n=void 0!==e.padding?e.padding:this.notePadding,i=e.orientation||t.orientation||"topBottom",o=e.lineType||t.lineType,r=e.align||t.align||"dynamic";"vertical"===o?i="leftRight":"horizontal"===o&&(i="topBottom");var a=function(t){var e=t.padding,n=void 0===e?0:e,i=t.bbox,o=void 0===i?{x:0,y:0,width:0,height:0}:i,r=t.align,a=t.orientation,s=t.offset,c=void 0===s?{x:0,y:0}:s,u=-o.x,l=0;return-1!==ue.indexOf(a)?(r=ce(r,c.x),c.y<0&&"topBottom"===a||"top"===a?l-=o.height+n:l+=n,"middle"===r?u-=o.width/2:"right"===r&&(u-=o.width)):-1!==le.indexOf(a)&&(r=se(r,c.y),c.x<0&&"leftRight"===a||"left"===a?u-=o.width+n:u+=n,"middle"===r?l-=o.height/2:"top"===r&&(l-=o.height)),{x:u,y:l}}({padding:n,bbox:t.bbox,offset:this.annotation.offset,orientation:i,align:r}),s=a.x,c=a.y;return this.offsetCornerX=s+this.annotation.dx,this.offsetCornerY=c+this.annotation.dy,this.note&&this.noteContent.attr("transform","translate("+s+", "+c+")"),[]}},{key:"drawOnScreen",value:function(t,e){return this.drawOnSVG(t,e)}},{key:"redrawSubject",value:function(){this.subject&&this.drawOnScreen(this.subject,this.drawSubject())}},{key:"redrawConnector",value:function(){this.connector&&this.drawOnScreen(this.connector,this.drawConnector())}},{key:"redrawNote",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getNoteBBox();this.noteContent&&this.drawOnScreen(this.noteContent,this.drawNoteContent({bbox:t})),this.note&&this.drawOnScreen(this.note,this.drawNote({bbox:t}))}},{key:"setPosition",value:function(){var t=this.annotation.position;this.a.attr("transform","translate("+t.x+", "+t.y+")")}},{key:"setOffset",value:function(){if(this.note){var t=this.annotation.offset;this.note.attr("transform","translate("+t.x+", "+t.y+")")}}},{key:"setPositionWithAccessors",value:function(t){t&&this.annotation.data&&(this.mapX(t),this.mapY(t)),this.setPosition()}},{key:"setClassName",value:function(){this.a.attr("class","annotation "+(this.className&&this.className())+" "+(this.editMode?"editable":"")+" "+(this.annotation.className||""))}},{key:"draw",value:function(){this.setClassName(),this.setPosition(),this.setOffset(),this.redrawSubject(),this.redrawConnector(),this.redrawNote()}},{key:"dragstarted",value:function(){p.sourceEvent.stopPropagation(),this.dispatcher&&this.dispatcher.call("dragstart",this.a,this.annotation),this.a.classed("dragging",!0),this.a.selectAll("circle.handle").style("pointer-events","none")}},{key:"dragended",value:function(){this.dispatcher&&this.dispatcher.call("dragend",this.a,this.annotation),this.a.classed("dragging",!1),this.a.selectAll("circle.handle").style("pointer-events","all")}},{key:"dragSubject",value:function(){var t=this.annotation.position;t.x+=p.dx,t.y+=p.dy,this.annotation.position=t}},{key:"dragNote",value:function(){var t=this.annotation.offset;t.x+=p.dx,t.y+=p.dy,this.annotation.offset=t}},{key:"mapHandles",value:function(t){var e=this;return t.map(function(t){return ee({},t,{start:e.dragstarted.bind(e),end:e.dragended.bind(e)})})}}]),t}(),ve=function(t,e,n){return function(i){function o(t){Kt(this,o);var n=oe(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return n.typeSettings=e,e.disable&&e.disable.forEach(function(t){n[t]&&n[t].remove(),n[t]=void 0,"note"===t&&(n.noteContent=void 0)}),n}return ie(o,t),te(o,[{key:"className",value:function(){return""+(e.className||ne(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"className",this)&&ne(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"className",this).call(this)||"")}},{key:"drawSubject",value:function(t){return this.typeSettings.subject=ee({},e.subject,this.typeSettings.subject),ne(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"drawSubject",this).call(this,ee({},t,this.typeSettings.subject))}},{key:"drawConnector",value:function(t){return this.typeSettings.connector=ee({},e.connector,this.typeSettings.connector),ne(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"drawConnector",this).call(this,ee({},t,e.connector,this.typeSettings.connector))}},{key:"drawNote",value:function(t){return this.typeSettings.note=ee({},e.note,this.typeSettings.note),ne(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"drawNote",this).call(this,ee({},t,e.note,this.typeSettings.note))}},{key:"drawNoteContent",value:function(t){return ne(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"drawNoteContent",this).call(this,ee({},t,e.note,this.typeSettings.note))}}],[{key:"init",value:function(t,e){return ne(o.__proto__||Object.getPrototypeOf(o),"init",this).call(this,t,e),n&&(t=n(t,e)),t}}]),o}()},ge=function(t){function e(t){Kt(this,e);var n=oe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.textWrap=t.textWrap||120,n.drawText(),n}return ie(e,ye),te(e,[{key:"updateTextWrap",value:function(t){this.textWrap=t,this.drawText()}},{key:"drawText",value:function(){if(this.note){Se(this.note,[this.annotation],"g","annotation-note-content");var t=this.note.select("g.annotation-note-content");Se(t,[this.annotation],"rect","annotation-note-bg"),Se(t,[this.annotation],"text","annotation-note-label"),Se(t,[this.annotation],"text","annotation-note-title");var e={height:0},n=this.a.select("text.annotation-note-label"),i=this.annotation.note&&this.annotation.note.wrap||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.wrap||this.textWrap,o=this.annotation.note&&this.annotation.note.wrapSplitter||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.wrapSplitter,r=this.annotation.note&&this.annotation.note.bgPadding||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.bgPadding,a={top:0,bottom:0,left:0,right:0};if("number"==typeof r?a={top:r,bottom:r,left:r,right:r}:r&&"object"===(void 0===r?"undefined":Qt(r))&&(a=ee(a,r)),this.annotation.note.title){var s=this.a.select("text.annotation-note-title");s.text(this.annotation.note.title),s.attr("fill",this.annotation.color),s.attr("font-weight","bold"),s.call(Ee,i,o),e=s.node().getBBox()}n.text(this.annotation.note.label).attr("dx","0"),n.call(Ee,i,o),n.attr("y",1.1*e.height||0),n.attr("fill",this.annotation.color);var c=this.getNoteBBox();this.a.select("rect.annotation-note-bg").attr("width",c.width+a.left+a.right).attr("height",c.height+a.top+a.bottom).attr("x",c.x-a.left).attr("y",-a.top).attr("fill","white").attr("fill-opacity",0)}}}]),e}(),me=ve(ge,{className:"label",note:{align:"middle"},disable:["subject"]}),xe=ve(ge,{className:"callout",note:{lineType:"horizontal"},disable:["subject"]}),be=ve(xe,{className:"callout elbow",connector:{type:"elbow"},disable:["subject"]}),we=ve(xe,{className:"callout curve",connector:{type:"curve"},disable:["subject"]}),Me=ve(ye,{className:"badge",subject:{type:"badge"},disable:["connector","note"]}),je=ve(ge,{className:"callout circle",subject:{type:"circle"},note:{lineType:"horizontal"},connector:{type:"elbow"}}),ke=ve(ge,{className:"callout rect",subject:{type:"rect"},note:{lineType:"horizontal"},connector:{type:"elbow"}}),Ae=function(t){function e(){return Kt(this,e),oe(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return ie(e,xe),te(e,[{key:"mapY",value:function(t){ne(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mapY",this).call(this,t);var n=this.annotation;(n.subject.x1||n.subject.x2)&&n.data&&t.y&&(n.y=t.y(n.data)),!n.subject.x1&&!n.subject.x2||n.x||(n.x=n.subject.x1||n.subject.x2)}},{key:"mapX",value:function(t){ne(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mapX",this).call(this,t);var n=this.annotation;(n.subject.y1||n.subject.y2)&&n.data&&t.x&&(n.x=t.x(n.data)),!n.subject.y1&&!n.subject.y2||n.y||(n.y=n.subject.y1||n.subject.y2)}}]),e}(),Oe=ve(Ae,{className:"callout xythreshold",subject:{type:"threshold"}}),Se=function(t,e,n,i,o){var r=t.selectAll(n+"."+(o||i)).data(e);return r.enter().append(n).merge(r).attr("class",i),r.exit().remove(),t},Te=function(t,e,n){var i=n.component,o=n.name;i&&i.on("mouseover.annotations",function(){t.call(o+"over",i,e)}).on("mouseout.annotations",function(){return t.call(o+"out",i,e)}).on("click.annotations",function(){return t.call(o+"click",i,e)})},Ee=function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.2;t.each(function(){for(var t=U(this),o=t.text().split(n||/[ \t\r\n]+/).reverse().filter(function(t){return""!==t}),r=void 0,a=[],s=t.text(null).append("tspan").attr("x",0).attr("dy","0.8em");r=o.pop();)a.push(r),s.text(a.join(" ")),s.node().getComputedTextLength()>e&&a.length>1&&(a.pop(),s.text(a.join(" ")),a=[r],s=t.append("tspan").attr("x",0).attr("dy",i+"em").text(r))})},Pe=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":not(.handle)";return t?t.selectAll(e).nodes().reduce(function(t,e){var n=e.getBBox();t.x=Math.min(t.x,n.x),t.y=Math.min(t.y,n.y),t.width=Math.max(t.width,n.width);var i=e&&e.attributes&&e.attributes.y;return t.height=Math.max(t.height,(i&&parseFloat(i.value)||0)+n.height),t},{x:0,y:0,width:0,height:0}):{x:0,y:0,width:0,height:0}};function Ne(){var t=[],e=void 0,n=void 0,i=[],o={},r={},a=!1,s=void 0,c=xe,u=void 0,l=void 0,h=tt("subjectover","subjectout","subjectclick","connectorover","connectorout","connectorclick","noteover","noteout","noteclick","dragend","dragstart"),f=void 0,d=function(n){f=n,a||n.selectAll("circle.handle").remove();var d=t.map(function(t){return t.type||(t.type=c),t.disable||(t.disable=i),new re(t)});e=e||new ae({annotations:d,accessors:o,accessorsInverse:r,ids:s}),n.selectAll("g").data([e]).enter().append("g").attr("class","annotations");var p=n.select("g.annotations");Se(p,e.annotations,"g","annotation"),p.selectAll("g.annotation").each(function(t){var e=U(this);e.attr("class","annotation"),Se(e,[t],"g","annotation-connector"),Se(e,[t],"g","annotation-subject"),Se(e,[t],"g","annotation-note"),Se(e.select("g.annotation-note"),[t],"g","annotation-note-content"),t.type="[object Object]"===t.type.toString()?t.type:new t.type({a:e,annotation:t,textWrap:u,notePadding:l,editMode:a,dispatcher:h,accessors:o}),t.type.draw(),t.type.drawText&&t.type.drawText()})};return d.json=function(){return console.log("Annotations JSON was copied to your clipboard. Please note the annotation type is not JSON compatible. It appears in the objects array in the console, but not in the copied JSON.",e.json),window.copy(JSON.stringify(e.json.map(function(t){return delete t.type,t}))),d},d.update=function(){return t&&e&&(t=e.annotations.map(function(t){return t.type.draw(),t})),d},d.updateText=function(){return e&&(e.updateText(u),t=e.annotations),d},d.updatedAccessors=function(){return e.setPositionWithAccessors(),t=e.annotations,d},d.disable=function(n){return arguments.length?(i=n,e&&(e.updateDisable(i),t=e.annotations),d):i},d.textWrap=function(n){return arguments.length?(u=n,e&&(e.updateTextWrap(u),t=e.annotations),d):u},d.notePadding=function(n){return arguments.length?(l=n,e&&(e.updateNotePadding(l),t=e.annotations),d):l},d.type=function(n,i){return arguments.length?(c=n,e&&(e.annotations.map(function(t){t.type.note&&t.type.note.selectAll("*:not(.annotation-note-content)").remove(),t.type.noteContent&&t.type.noteContent.selectAll("*").remove(),t.type.subject&&t.type.subject.selectAll("*").remove(),t.type.connector&&t.type.connector.selectAll("*").remove(),t.type.typeSettings={},t.type=c,t.subject=i&&i.subject||t.subject,t.connector=i&&i.connector||t.connector,t.note=i&&i.note||t.note}),t=e.annotations),d):c},d.annotations=function(n){return arguments.length?(t=n,e&&e.annotations&&(t.some(function(t){return!t.type||"[object Object]"!==t.type.toString()})?(e=null,d(f)):e.annotations=t),d):e&&e.annotations||t},d.context=function(t){return arguments.length?(n=t,d):n},d.accessors=function(t){return arguments.length?(o=t,d):o},d.accessorsInverse=function(t){return arguments.length?(r=t,d):r},d.ids=function(t){return arguments.length?(s=t,d):s},d.editMode=function(n){return arguments.length?(a=n,f&&f.selectAll("g.annotation").classed("editable",a),e&&(e.editMode(a),t=e.annotations),d):a},d.collection=function(t){return arguments.length?(e=t,d):e},d.on=function(){var t=h.on.apply(h,arguments);return t===h?d:t},d}var Ce={annotation:Ne,annotationTypeBase:ye,annotationLabel:me,annotationCallout:xe,annotationCalloutCurve:we,annotationCalloutElbow:be,annotationCalloutCircle:je,annotationCalloutRect:ke,annotationXYThreshold:Oe,annotationBadge:Me,annotationCustomType:ve};e.default=Ce},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=a(n(0));function a(t){return t&&t.__esModule?t:{default:t}}a(n(1));var s={top:160,bottom:10,left:0,right:20},c=12,u=5*c,l=128,h=.4,f=0,d=0,p=0,_=null,y=null,v=d3.select("#impact").select("figure").select(".figure__chart"),g=v.select("svg"),m=g.select(".g-vis"),x=g.select(".g-axis"),b=null;function w(){var t=d3.mouse(this),e=o(t,2),n=(e[0],e[1]),i=_.length,r=Math.max(0,Math.min(Math.floor(n/p*i),i-1));b.classed("is-inactive",function(t,e){return e!==r})}function M(){b.classed("is-inactive",!1)}function j(){window.innerHeight,f=v.node().offsetWidth-s.left-s.right,d=u*h*_.length+s.top+s.bottom}function k(){j(),g.at({width:f+s.left+s.right,height:d+s.top+s.bottom}),m.at("transform","translate("+s.left+", "+s.top+")");var t=d3.extent(y,function(t){return t.bin_death_index}),e=d3.scaleLinear().domain(t).range([l+c,f]),n=d3.scaleLinear().domain([0,20]).range([u,0]),i=d3.line().x(function(t){return e(t.bin_death_index)}).y(function(t){return n(t.diff_percent)}).curve(d3.curveMonotoneX).defined(function(t){return t.ma}),o=d3.area().x(function(t){return e(t.bin_death_index)}).y0(n(0)).y1(function(t){return n(t.diff_percent)}).curve(d3.curveMonotoneX).defined(function(t){return t.ma});b.select("text").at({x:l,y:n.range()[0],"text-anchor":"end"}),b.select(".after--area").datum(function(t){return t.pageviews}).at("d",o),b.select(".after--line").datum(function(t){return t.pageviews}).at("d",i),b.at("transform",function(t,e){return"translate(0,"+e*u*h+")"}),p=d-s.top+s.bottom+u*h,m.select(".interaction").at({x:0,y:0,width:f,height:p});var r=d3.axisTop(e).tickValues([30,60,90,120,150]).tickSize(-d).tickFormat(function(t,e){return t+(0===e?" days":"")});x.select(".axis").call(r).at("transform","translate("+s.left+", "+(s.top-u*h)+")"),x.select(".tick").select("text").at("text-anchor","start")}e.default={init:function(){new Promise(function(t,e){var n,o=["people","impact"].map(function(t){return"assets/data/"+t+".csv"});(n=d3).loadData.apply(n,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(o).concat([function(n,o){n&&e(n);var a=r.default.people(o[0]);y=r.default.ma(o[1]),_=a.map(function(t){var e=y.filter(function(e){return e.pageid===t.pageid}),n={bin_death_index:e[e.length-1].bin_death_index,diff_percent:0,ma:1};return e.push(n),i({},t,{pageviews:e})}).filter(function(t){return 92===t.pageviews.length}),t()}]))}).then(function(){j(),function(){_.sort(function(t,e){var n=d3.median(t.pageviews,function(t){return t.diff_percent}),i=d3.median(e.pageviews,function(t){return t.diff_percent});return d3.descending(n,i)});var t=(b=m.selectAll(".person")).data(_).enter().append("g.person");(b=t.merge(b)).append("text").text(function(t){return t.display}),b.append("path.after--area"),b.append("path.after--line"),m.append("rect.interaction").on("mousemove",w).on("mouseleave",M)}(),k()})},resize:k}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=s(n(0)),a=s(n(1));function s(t){return t&&t.__esModule?t:{default:t}}var c=null,u=d3.select("#change"),l=u.select("figure"),h=l.select("table"),f=h.select("tbody"),d=u.select(".btn");function p(t){return d3.format(",")(Math.round(t))}function _(){h.select("thead").node().offsetHeight}e.default={init:function(){new Promise(function(t,e){var n,o=["people"].map(function(t){return"assets/data/"+t+".csv"});(n=d3).loadData.apply(n,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(o).concat([function(n,o){n&&e(n);var a=r.default.people(o[0]);c=a.map(function(t){return i({},t,{change:t.death_views_adjusted_2/t.median_views_adjusted_bd_2})}),t()}]))}).then(function(){_(),function(){c.sort(function(t,e){return d3.descending(t.change,e.change)});var t=d3.extent(c,function(t){return t.change}),e=d3.scaleLinear().domain(t).range([0,.8]),n=f.selectAll("tr").data(c).enter().append("tr");n.append("td.name").text(function(t){return t.display}),n.append("td.avg.number").text(function(t){return p(t.median_views_adjusted_bd_2)}),n.append("td.death.number").text(function(t){return p(t.death_views_adjusted_2)}),n.append("td.change.number").text(function(t,e){return function(t){return d3.format(",.0%")(t)}(t.change).replace("%","")}).st("background-color",function(t){var n=o(a.default.primary.rgb,3);return"rgba("+n[0]+","+n[1]+", "+n[2]+", "+e(t.change)+")"})}(),d.on("click",function(){var t=l.classed("is-truncated"),e=t?"Show Fewer":"Show More";if(d.text(e),l.classed("is-truncated",!t),!t){var n=+d.at("data-y");window.scrollTo(0,n)}d.at("data-y",window.scrollY),l.select(".show-more").classed("is-visible",!t)})})},resize:_}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=s(n(0)),a=s(n(2));function s(t){return t&&t.__esModule?t:{default:t}}d3.easeCubicInOut;var c=12,u=null,l=null,h=d3.select("#care").select(".figure--chart").select("ul"),f=null;function d(t){var e=d3.mouse(this),n=d3.mouse(h.node()),i=o(n,2),r=i[0],s=i[1],c={x:r-e[0],y:s};a.default.show({el:f,d:t,pos:c})}function p(){window.innerHeight}e.default={init:function(){new Promise(function(t,e){var n,o=["people","care"].map(function(t){return"assets/data/"+t+".csv"});(n=d3).loadData.apply(n,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(o).concat([function(n,o){n&&e(n);var a=r.default.people(o[0]);l=r.default.pageview(o[1]),u=a.map(function(t){return i({},t,{pageviews:l.filter(function(e){return e.pageid===t.pageid})})}).map(function(t){var e=t.pageviews.length,n=function(t){var e=t.last_updated,n=t.pageviews,i=n.length;return n[i-1].timestamp===e?null:Math.floor(i/7)}(t);return i({},t,{days_until_norm:e,weeks_until_norm:n,week_category:n||0===n?n<=c?n:c+1:c+2})}),t()}]))}).then(function(){p(),function(){var t=d3.nest().key(function(t){return t.week_category}).entries(u).map(function(t){return i({},t,{key:+t.key})}),e=d3.range(c+3).map(function(e){return t.find(function(t){return t.key===e})||{key:e,values:[]}}),n=h.selectAll(".week").data(e).enter().append("li.week");n.append("p.label").html(function(t){return t.key===c+1?t.key+"+":t.key===c+2?"???":t.key+"&nbsp;"}),n.append("ul.people").selectAll(".person").data(function(t){return t.values}).enter().append("li.person").text(function(t){return t.display}).on("mouseenter",d).on("mouseleave",function(){a.default.hide(f)})}(),f=a.default.init({container:h}),h.on("mouseleave",function(){a.default.hide(f)})})},resize:p}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.text,n=t.chars,i=void 0===n?100:n,o=t.clean,r=void 0===o||o,a=t.ellipses,s=void 0!==a&&a,c=e.substring(0,i),u=r?c.lastIndexOf(" "):c.length;return c.substring(0,u)+(s?"...":"")}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.substring(0,4),n=+t.substring(4,6)-1,i=t.substring(6,8);return new Date(e,n,i)}},function(t,e,n){t.exports=function(){"use strict";function t(t){for(var e=t.length,n=[],i=0;i<e;i+=1)n.push(t[i]);return n}function e(t){return t instanceof Element?t:"string"==typeof t?document.querySelector(t):null}function n(t){return"scrollama__debug-offset--"+t.id}function i(t){!function(t){var e=t.id,i=t.offsetVal,o=t.stepClass,r=document.createElement("div");r.setAttribute("id",n({id:e})),r.setAttribute("class","scrollama__debug-offset"),r.style.position="fixed",r.style.left="0",r.style.width="100%",r.style.height="0px",r.style.borderTop="2px dashed black",r.style.zIndex="9999";var a=document.createElement("p");a.innerText='".'+o+'" trigger: '+i,a.style.fontSize="12px",a.style.fontFamily="monospace",a.style.color="black",a.style.margin="0",a.style.padding="6px",r.appendChild(a),document.body.appendChild(r)}({id:t.id,offsetVal:t.offsetVal,stepClass:t.stepEl[0].getAttribute("class")})}function o(t){var e=t.id,i=(t.stepOffsetHeight,t.offsetMargin);t.offsetVal,function(t){var e=t.offsetMargin,i=n({id:t.id});document.querySelector("#"+i).style.top=e+"px"}({id:e,offsetMargin:i})}function r(t){var e=t.id,n=t.index,i=t.state,o=function(t){return"scrollama__debug-step--"+t.id+"-"+t.i}({id:e,i:n}),r=document.querySelector("#"+o+"_above"),a=document.querySelector("#"+o+"_below"),s="enter"===i?"block":"none";r&&(r.style.display=s),a&&(a.style.display=s)}return function(){var n=1,a={},s={},c=null,u=null,l=null,h=null,f=0,d=0,p=0,_=0,y=null,v=null,g=null,m=!1,x=!1,b=!1,w=!1,M=0,j=!1,k=!1,A=null,O=null,S=-1,T=null,E=[];function P(t){var e=0;if(t.offsetParent)do{e+=t.offsetTop,t=t.offsetParent}while(t);return e<0?0:e}function N(t){return+t.getAttribute("data-scrollama-index")}function C(){window.pageYOffset>S?T="down":window.pageYOffset<S&&(T="up"),S=window.pageYOffset}function Y(){p=window.innerHeight,_=function(){var t=document.body,e=document.documentElement;return Math.max(t.scrollHeight,t.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight)}(),g=u?u.getBoundingClientRect():null,d=f*p,y=l?l.map(function(t){return t.offsetHeight}):[],v=l?l.map(P):[],x&&m&&J(),b&&o({id:h,stepOffsetHeight:y,offsetMargin:d,offsetVal:f})}function R(t){t&&!x?(m&&J(),x=!0):t||(s.top&&s.top.disconnect(),s.bottom&&s.bottom.disconnect(),s.stepAbove&&s.stepAbove.forEach(function(t){return t.disconnect()}),s.stepBelow&&s.stepBelow.forEach(function(t){return t.disconnect()}),s.stepProgress&&s.stepProgress.forEach(function(t){return t.disconnect()}),s.viewportAbove&&s.viewportAbove.forEach(function(t){return t.disconnect()}),s.viewportBelow&&s.viewportBelow.forEach(function(t){return t.disconnect()}),x=!1)}function B(t,e){if("above"===e)for(var n=0;n<t;n++){var i=A[n];"enter"===i.state&&I(l[n],"down"),"up"===i.direction&&(X(l[n],"down",!1),I(l[n],"down"))}else if("below"===e)for(var o=A.length-1;o>t;o--){var r=A[o];"enter"===r.state&&I(l[o],"up"),"down"===r.direction&&(X(l[o],"up",!1),I(l[o],"up"))}}function X(t,e,n){void 0===n&&(n=!0);var i=N(t),o={element:t,index:i,direction:e};A[i].direction=e,A[i].state="enter",j&&n&&"down"===e&&B(i,"above"),j&&n&&"up"===e&&B(i,"below"),a.stepEnter&&"function"==typeof a.stepEnter&&!E[i]&&(a.stepEnter(o,A),b&&r({id:h,index:i,state:"enter"}),k&&(E[i]=!0)),w&&L(t,"down"===e?0:1)}function I(t,e){var n=N(t),i={element:t,index:n,direction:e};A[n].direction=e,A[n].state="exit",w&&L(t,"down"===e?1:0),a.stepExit&&"function"==typeof a.stepExit&&(a.stepExit(i,A),b&&r({id:h,index:n,state:"exit"}))}function L(t,e){var n={element:t,index:N(t),progress:e};a.stepProgress&&"function"==typeof a.stepProgress&&a.stepProgress(n)}function D(){var t={direction:T};O.direction=T,O.state="enter",a.containerEnter&&"function"==typeof a.containerEnter&&a.containerEnter(t)}function q(){var t={direction:T};O.direction=T,O.state="exit",a.containerExit&&"function"==typeof a.containerExit&&a.containerExit(t)}function z(t){C(),t.forEach(function(t){var e=t.isIntersecting,i=t.boundingClientRect,o=t.target,r=i.bottom,a=i.height,s=r-d,c=N(o),u=A[c];s>=-n&&(e&&"down"===T&&"enter"!==u.state?X(o,T):e||"up"!==T||"enter"!==u.state?!e&&s>=a&&"down"===T&&"enter"===u.state&&I(o,T):I(o,T))})}function H(t){C(),t.forEach(function(t){var e=t.isIntersecting,i=t.boundingClientRect,o=t.target,r=i.bottom,a=i.height,s=r-d,c=N(o),u=A[c];s>=-n&&s<a&&e&&"up"===T&&"enter"!==u.state?X(o,T):s<=n&&!e&&"down"===T&&"enter"===u.state&&I(o,T)})}function W(t){C(),t.forEach(function(t){var e=t.isIntersecting,n=t.target,i=N(n),o=A[i];e&&"down"===T&&"enter"!==o.state&&"down"!==o.direction&&(X(n,"down"),I(n,"down"))})}function F(t){C(),t.forEach(function(t){var e=t.isIntersecting,n=t.target,i=N(n),o=A[i];e&&"up"===T&&"enter"!==o.state&&"up"!==o.direction&&(X(n,"up"),I(n,"up"))})}function V(t){C(),t.forEach(function(t){var e=t.isIntersecting,i=t.intersectionRatio,o=t.boundingClientRect,r=t.target,a=o.bottom;e&&a-d>=-n&&L(r,+i.toFixed(3))})}function U(t){C();var e=t[0],i=e.isIntersecting,o=e.boundingClientRect;(o.top,o.bottom)>-n&&(i?D():"enter"===O.state&&q())}function G(t){C();var e=t[0],i=e.isIntersecting;e.boundingClientRect.top<n&&(i?D():"enter"===O.state&&q())}function J(){s.viewportAbove&&s.viewportAbove.forEach(function(t){return t.disconnect()}),s.viewportAbove=l.map(function(t,e){var n=v[e],i=-(p-d+y[e]),o=new IntersectionObserver(W,{root:null,rootMargin:n+"px 0px "+i+"px 0px",threshold:0});return o.observe(t),o}),s.viewportBelow&&s.viewportBelow.forEach(function(t){return t.disconnect()}),s.viewportBelow=l.map(function(t,e){var n=-(d+y[e]),i=_-v[e]-y[e]-d,o=new IntersectionObserver(F,{root:null,rootMargin:n+"px 0px "+i+"px 0px",threshold:0});return o.observe(t),o}),s.stepAbove&&s.stepAbove.forEach(function(t){return t.disconnect()}),s.stepAbove=l.map(function(t,e){var n=y[e],i=new IntersectionObserver(z,{root:null,rootMargin:n+"px 0px "+(-p+d)+"px 0px",threshold:0});return i.observe(t),i}),s.stepBelow&&s.stepBelow.forEach(function(t){return t.disconnect()}),s.stepBelow=l.map(function(t,e){var n=-d,i=_-p+y[e]+d,o=new IntersectionObserver(H,{root:null,rootMargin:n+"px 0px "+i+"px 0px",threshold:0});return o.observe(t),o}),w&&(s.stepProgress&&s.stepProgress.forEach(function(t){return t.disconnect()}),s.stepProgress=l.map(function(t,e){var n=y[e]-d+"px 0px "+(-p+d)+"px 0px",i=function(t){for(var e=Math.ceil(t/M),n=[],i=1/e,o=0;o<e;o++)n.push(o*i);return n}(y[e]),o=new IntersectionObserver(V,{root:null,rootMargin:n,threshold:i});return o.observe(t),o})),c&&u&&(function(){s.top&&s.top.unobserve(c);var t={root:null,rootMargin:p+"px 0px -"+p+"px 0px",threshold:0};s.top=new IntersectionObserver(U,t),s.top.observe(c)}(),function(){s.bottom&&s.bottom.unobserve(c);var t={root:null,rootMargin:"-"+g.height+"px 0px "+g.height+"px 0px",threshold:0};s.bottom=new IntersectionObserver(G,t),s.bottom.observe(c)}())}var $={setup:function(n){var o=n.container,r=n.graphic,a=n.step,s=n.offset;void 0===s&&(s=.5);var d=n.progress;void 0===d&&(d=!1);var p=n.threshold;void 0===p&&(p=4);var _=n.debug;void 0===_&&(_=!1);var y=n.order;void 0===y&&(y=!0);var v=n.once;return void 0===v&&(v=!1),h=function(){var t="abcdefghijklmnopqrstuv",e=t.length,n=(new Date).getTime();return""+[0,0,0].map(function(n){return t[Math.floor(Math.random()*e)]}).join("")+n}(),l=function(e,n){return void 0===n&&(n=document),"string"==typeof e?t(n.querySelectorAll(e)):e instanceof NodeList?t(e):e instanceof Array?e:[]}(a),c=o?e(o):null,u=r?e(r):null,l.length?(b=_,w=d,j=y,k=v,$.offsetTrigger(s),M=Math.max(1,+p),m=!0,b&&i({id:h,stepEl:l,offsetVal:f}),l.forEach(function(t,e){return t.setAttribute("data-scrollama-index",e)}),A=l.map(function(){return{direction:null,state:null}}),O={direction:null,state:null},Y(),R(!0),$):(console.error("scrollama error: no step elements"),$)},resize:function(){return Y(),$},enable:function(){return R(!0),$},disable:function(){return R(!1),$},destroy:function(){R(!1),Object.keys(a).forEach(function(t){return a[t]=null}),Object.keys(s).forEach(function(t){return s[t]=null})},offsetTrigger:function(t){return t&&(isNaN(t),1)?(f=Math.min(Math.max(0,t),1),$):f},onStepEnter:function(t){return a.stepEnter=t,$},onStepExit:function(t){return a.stepExit=t,$},onStepProgress:function(t){return a.stepProgress=t,$},onContainerEnter:function(t){return a.containerEnter=t,$},onContainerExit:function(t){return a.containerExit=t,$}};return $}}()},function(t,e){!function(e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=!1;if(e.getComputedStyle){var r=n.createElement("div");["","-webkit-","-moz-","-ms-"].some(function(t){try{r.style.position=t+"sticky"}catch(t){}return""!=r.style.position})&&(o=!0)}else o=!0;var a="undefined"!=typeof ShadowRoot,s={top:null,left:null},c=[];function u(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function l(t){return parseFloat(t)||0}function h(t){for(var e=0;t;)e+=t.offsetTop,t=t.offsetParent;return e}var f=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!(e instanceof HTMLElement))throw new Error("First argument must be HTMLElement");if(c.some(function(t){return t._node===e}))throw new Error("Stickyfill is already applied to this node");this._node=e,this._stickyMode=null,this._active=!1,c.push(this),this.refresh()}return i(t,[{key:"refresh",value:function(){if(!o&&!this._removed){this._active&&this._deactivate();var t=this._node,i=getComputedStyle(t),r={top:i.top,display:i.display,marginTop:i.marginTop,marginBottom:i.marginBottom,marginLeft:i.marginLeft,marginRight:i.marginRight,cssFloat:i.cssFloat};if(!isNaN(parseFloat(r.top))&&"table-cell"!=r.display&&"none"!=r.display){this._active=!0;var s=t.parentNode,c=a&&s instanceof ShadowRoot?s.host:s,f=t.getBoundingClientRect(),d=c.getBoundingClientRect(),p=getComputedStyle(c);this._parent={node:c,styles:{position:c.style.position},offsetHeight:c.offsetHeight},this._offsetToWindow={left:f.left,right:n.documentElement.clientWidth-f.right},this._offsetToParent={top:f.top-d.top-l(p.borderTopWidth),left:f.left-d.left-l(p.borderLeftWidth),right:-f.right+d.right-l(p.borderRightWidth)},this._styles={position:t.style.position,top:t.style.top,bottom:t.style.bottom,left:t.style.left,right:t.style.right,width:t.style.width,marginTop:t.style.marginTop,marginLeft:t.style.marginLeft,marginRight:t.style.marginRight};var _=l(r.top);this._limits={start:f.top+e.pageYOffset-_,end:d.top+e.pageYOffset+c.offsetHeight-l(p.borderBottomWidth)-t.offsetHeight-_-l(r.marginBottom)};var y=p.position;"absolute"!=y&&"relative"!=y&&(c.style.position="relative"),this._recalcPosition();var v=this._clone={};v.node=n.createElement("div"),u(v.node.style,{width:f.right-f.left+"px",height:f.bottom-f.top+"px",marginTop:r.marginTop,marginBottom:r.marginBottom,marginLeft:r.marginLeft,marginRight:r.marginRight,cssFloat:r.cssFloat,padding:0,border:0,borderSpacing:0,fontSize:"1em",position:"static"}),s.insertBefore(v.node,t),v.docOffsetTop=h(v.node)}}}},{key:"_recalcPosition",value:function(){if(this._active&&!this._removed){var t=s.top<=this._limits.start?"start":s.top>=this._limits.end?"end":"middle";if(this._stickyMode!=t){switch(t){case"start":u(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:this._offsetToParent.top+"px",bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"middle":u(this._node.style,{position:"fixed",left:this._offsetToWindow.left+"px",right:this._offsetToWindow.right+"px",top:this._styles.top,bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"end":u(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:"auto",bottom:0,width:"auto",marginLeft:0,marginRight:0})}this._stickyMode=t}}}},{key:"_fastCheck",value:function(){this._active&&!this._removed&&(Math.abs(h(this._clone.node)-this._clone.docOffsetTop)>1||Math.abs(this._parent.node.offsetHeight-this._parent.offsetHeight)>1)&&this.refresh()}},{key:"_deactivate",value:function(){var t=this;this._active&&!this._removed&&(this._clone.node.parentNode.removeChild(this._clone.node),delete this._clone,u(this._node.style,this._styles),delete this._styles,c.some(function(e){return e!==t&&e._parent&&e._parent.node===t._parent.node})||u(this._parent.node.style,this._parent.styles),delete this._parent,this._stickyMode=null,this._active=!1,delete this._offsetToWindow,delete this._offsetToParent,delete this._limits)}},{key:"remove",value:function(){var t=this;this._deactivate(),c.some(function(e,n){if(e._node===t._node)return c.splice(n,1),!0}),this._removed=!0}}]),t}(),d={stickies:c,Sticky:f,addOne:function(t){if(!(t instanceof HTMLElement)){if(!t.length||!t[0])return;t=t[0]}for(var e=0;e<c.length;e++)if(c[e]._node===t)return c[e];return new f(t)},add:function(t){if(t instanceof HTMLElement&&(t=[t]),t.length){for(var e=[],n=function(n){var i=t[n];return i instanceof HTMLElement?c.some(function(t){if(t._node===i)return e.push(t),!0})?"continue":void e.push(new f(i)):(e.push(void 0),"continue")},i=0;i<t.length;i++)n(i);return e}},refreshAll:function(){c.forEach(function(t){return t.refresh()})},removeOne:function(t){if(!(t instanceof HTMLElement)){if(!t.length||!t[0])return;t=t[0]}c.some(function(e){if(e._node===t)return e.remove(),!0})},remove:function(t){if(t instanceof HTMLElement&&(t=[t]),t.length)for(var e=function(e){var n=t[e];c.some(function(t){if(t._node===n)return t.remove(),!0})},n=0;n<t.length;n++)e(n)},removeAll:function(){for(;c.length;)c[0].remove()}};o||function(){function t(){e.pageXOffset!=s.left?(s.top=e.pageYOffset,s.left=e.pageXOffset,d.refreshAll()):e.pageYOffset!=s.top&&(s.top=e.pageYOffset,s.left=e.pageXOffset,c.forEach(function(t){return t._recalcPosition()}))}t(),e.addEventListener("scroll",t),e.addEventListener("resize",d.refreshAll),e.addEventListener("orientationchange",d.refreshAll);var i=void 0;function o(){i=setInterval(function(){c.forEach(function(t){return t._fastCheck()})},500)}var r=void 0,a=void 0;"hidden"in n?(r="hidden",a="visibilitychange"):"webkitHidden"in n&&(r="webkitHidden",a="webkitvisibilitychange"),a?(n[r]||o(),n.addEventListener(a,function(){n[r]?clearInterval(i):o()})):o()}(),void 0!==t&&t.exports?t.exports=d:e.Stickyfill=d}(window,document)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},o=u(n(10)),r=u(n(9)),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(3)),s=u(n(0)),c=u(n(2));function u(t){return t&&t.__esModule?t:{default:t}}var l={top:20,bottom:40,left:40,right:20},h=12,f="57317",d=new Date(2016,2,1),p=new Date(2016,3,27),_=4,y=12,v=3e3,g=d3.easeCubicInOut,m=d3.select("header").node().offsetHeight,x=0,b=0,w=0,M=null,j=null,k=null,A="context",O=!1,S=d3.select("#perspective"),T=S.select("article").selectAll(".step"),E=S.select("figure"),P=E.select(".figure__chart"),N=P.select("svg"),C=N.select(".g-vis"),Y=N.select(".g-axis"),R=N.select(".g-voronoi"),B=C.select(".people"),X=null,I=(0,r.default)(),L=(0,r.default)(),D=d3.voronoi();function q(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k[0].pageviews;return d3.scaleTime().domain(d3.extent(t,function(t){return t.date})).nice().range([0,x])}function z(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k[0].pageviews,e=d3.max(t,function(t){return t.views_adjusted});return d3.scaleLinear().domain([0,e]).nice().range([b,0])}function H(t){var e=t.scaleX,n=t.scaleY;return d3.line().x(function(t){return e(t.date)}).y(function(t){return n(t.views_adjusted)}).curve(d3.curveMonotoneX).defined(function(t){return t.views_adjusted})}function W(t){var e=t.scaleX,n=t.scaleY,i=t.dur,o=t.ticks,r=void 0===o?d3.timeMonth.every(1):o,a=d3.axisLeft(n).tickFormat(function(t,e){return d3.format(".2s")(t)+(6===e?" adjusted pageviews":"")}).tickSize(-(x+l.left)).tickPadding(l.left).ticks(5);Y.select(".axis--y").transition().duration(i.slow).ease(g).call(a).at("transform","translate("+l.left+", "+l.top+")"),Y.selectAll(".axis--y text").at("text-anchor","start").at("y",-h/2),Y.selectAll(".axis--y line").at("transform","translate("+-l.left+", 0)");var s=d3.axisBottom(e).ticks(r).tickSize(0).tickPadding(0).tickFormat(function(t){return(d3.timeYear(t)<t?d3.timeFormat("%b"):d3.timeFormat("%Y"))(t)});Y.select(".axis--x").transition().duration(i.slow).ease(g).call(s).at("transform","translate("+l.left+", "+(b+l.bottom-h)+")")}function F(t,e){var n=t.selectAll("path"),i=n.node().getTotalLength(),o=e?i-e:i;n.at({"stroke-dasharray":i+" "+i,"stroke-dashoffset":o})}function V(t){t.at("data-id",function(t){return t.pageid}),t.append("path"),t.append("g.circles")}function U(t,e){t.exit().transition().duration(e).st("opacity",0).remove()}function G(t,e){var n=e.scaleX,i=e.scaleY,o=e.r,r=void 0===o?_:o,a=t.select(".circles").selectAll("circle").data(function(t){return t.pageviews.filter(function(t){return["beyonce",f].includes(t.pageid)||0===t.bin_death_index})},function(t){return t.timestamp});a.enter().append("circle").classed("is-not-death-index",function(t){return 0!==t.bin_death_index}).at({cx:0,cy:0,r:r}).at("transform",function(t){return"translate("+n(t.date)+", "+i(t.views_adjusted)+")"}).merge(a).at("data-x",function(t){return n(t.date)}).at("data-y",function(t){return i(t.views_adjusted)}),a.exit().remove()}function J(t,e){var n=e.scaleX,i=e.scaleY,o=e.render,r=void 0===o||o,a=H({scaleX:n,scaleY:i});t.selectAll("path").data(function(t){return[t.pageviews]}),r&&t.selectAll("path").at("d",a)}function $(t,e){var n=e.start,o=void 0===n?-1:n,r=e.end,a=void 0===r?0:r;return t.map(function(t){return i({},t)}).filter(function(t){return t.bin_death_index>=o&&t.bin_death_index<=a})}function Z(t){var e=M.find(function(t){return t.pageid===f}).pageviews;return e[e.map(function(e,n){return{i:n,date:e.date,diff:e.date-t}}).filter(function(t){return t.diff>0})[0].i].bin_death_index}function Q(t){var e=t.leave,n=t.reverse,i=1;e?i=0:n&&(i=.33);var o=v*i;return{slow:o,medium:Math.floor(.33*o),fast:Math.floor(.1*o)}}function K(t){if(O){var e=t.data.pageid,n=M.find(function(t){return t.pageid===e});B.selectAll(".person").classed("is-active",function(t){return t.pageid===e});var i=d3.select("[data-id='"+e+"'"),o={x:+i.select("circle:last-of-type").at("data-x")+l.left,y:+i.select("circle:last-of-type").at("data-y")+l.top};c.default.show({el:X,d:n,pos:o})}}function tt(t){}function et(t){var e=t.scaleX,n=t.scaleY,i=t.annoData,o=t.dur,r=void 0===o?0:o,s=t.delay,c=void 0===s?0:s;C.select(".g-annotation").remove();var u=C.append("g.g-annotation");u.st("opacity",0);var l=a.annotationCustomType(a.annotationCalloutCircle,{className:"custom",connector:{type:"line"},note:{lineType:"horizontal",align:"dynamic"}}),h=i.map(function(t){return{note:{title:t.title,padding:t.padding,wrap:120},data:{date:t.value.date,views_adjusted:t.value.views_adjusted},dx:t.dx,dy:t.dy,subject:{radius:t.r,radiusPadding:_}}}),f=a.annotation().type(l).accessors({x:function(t){return e(t.date)},y:function(t){return n(t.views_adjusted)}}).annotations(h);u.call(f),u.transition().duration(r).delay(c).ease(g).st("opacity",1)}var nt={context:function(t){var e=t.reverse,n=Q({leave:t.leave,reverse:e}),i=k,o=q(),r=z();W({scaleX:o,scaleY:r,dur:{slow:0}});var a=B.selectAll(".person").data(i,function(t){return t.pageid}),s=a.enter().append("g.person").call(V).merge(a);s.call(J,{scaleX:o,scaleY:r}),s.call(G,{scaleX:o,scaleY:r}),s.classed("is-highlight",!0),s.selectAll("circle").transition().duration(n.fast).ease(g).at("r",_).st("stroke-width",_/2),et({scaleX:o,scaleY:r,annoData:[]}),U(a,n.fast)},lemonade:function(t){var e=t.reverse,n=t.leave;e||n||nt.context({leave:!0});var i=Q({leave:n,reverse:e}),o=k,r=[{value:o[0].pageviews[o[0].pageviews.length-1],title:"Lemonade is released",padding:.5*h,dx:-50,dy:50,r:15}],a=q(),s=z();W({scaleX:a,scaleY:s,dur:{slow:0}});var c=B.selectAll(".person").data(o,function(t){return t.pageid}),u=c.enter().append("g.person").call(V).merge(c);u.call(J,{scaleX:a,scaleY:s}),u.call(G,{scaleX:a,scaleY:s}),u.classed("is-highlight",!0),u.select("circle:last-of-type").transition().duration(i.fast).ease(g).at("r",y).st("stroke-width",6),et({scaleX:a,scaleY:s,annoData:r,dur:i.fast}),U(c,i.fast)},"prince-before":function(t){var e=t.reverse,n=t.leave;e||n||nt.lemonade({leave:!0});var o=Q({leave:n,reverse:e}),r=Z(d),a=M.filter(function(t){return t.pageid===f}).map(function(t){return i({},t,{pageviews:$(t.pageviews,{start:r,end:-1})})}).concat(k),s=q(),c=z();W({scaleX:s,scaleY:c,dur:o});var u=B.selectAll(".person").data(a,function(t){return t.pageid}),l=u.enter().append("g.person").call(V).merge(u);l.call(G,{scaleX:s,scaleY:c,r:_}),l.call(J,{scaleX:s,scaleY:c,render:!e});var h=H({scaleX:s,scaleY:c});if(e)l.selectAll("path").transition().duration(o.slow).ease(g).at("d",h).at("stroke-dashoffset",0).st("opacity",1),l.selectAll("circle").transition().duration(o.slow).ease(g).st("opacity",1).at("r",_).at("transform",function(t){return"translate("+s(t.date)+", "+c(t.views_adjusted)+")"});else{var p=l.filter(function(t){return t.pageid===f});p.call(F),p.selectAll("path").transition().duration(o.slow).ease(g).at("stroke-dashoffset",0),p.selectAll("circle").at("r",0).transition().duration(o.fast).delay(function(t,e,n){return o.slow*g(e/n.length)}).ease(g).at("r",function(t){return 0===t.bin_death_index?y:_}).st("stroke-width",function(t){return 0===t.bin_death_index?6:_/2})}et({scaleX:s,scaleY:c,annoData:[]}),l.classed("is-highlight",function(t){return t.pageid===f}),l.filter(function(t){return t.pageid===f}).raise(),U(u,o.fast)},"prince-spike":function(t){var e=t.reverse,n=t.leave;e||n||nt["prince-before"]({leave:!0});var o=Q({leave:n,reverse:e}),r=Z(d),a=M.filter(function(t){return t.pageid===f}).map(function(t){return i({},t,{pageviews:$(t.pageviews,{start:r,end:0})})}).concat(k),s=a.find(function(t){return t.pageid===f}).pageviews,c=q(),u=z(s);W({scaleX:c,scaleY:u,dur:o});var l=B.selectAll(".person").data(a,function(t){return t.pageid}),h=l.enter().append("g.person").call(V).merge(l),p=function(){var t=h.filter(function(t){return t.pageid===f}),i=t.selectAll("path").node().getTotalLength();t.call(J,{scaleX:c,scaleY:u}),t.call(G,{scaleX:c,scaleY:u,r:0}),n||e||t.call(F,i),t.selectAll("path").transition().duration(n?0:o.slow).ease(g).at("stroke-dashoffset",0),t.selectAll("circle").transition().duration(o.medium).delay(o.slow).ease(g).at("r",function(t){return 0===t.bin_death_index?y:_}).st("stroke-width",function(t){return 0===t.bin_death_index?6:_/2})},v=H({scaleX:c,scaleY:u});e?(h.call(G,{scaleX:c,scaleY:u}),h.call(J,{scaleX:c,scaleY:u,render:!e}),h.selectAll("path").at("d",v).at("stroke-dashoffset",0).at("stroke-dasharray","0 0").transition().duration(o.fast).delay(o.slow).ease(g).st("opacity",1),h.selectAll("circle").transition().duration(function(t){return 0===t.bin_death_index?o.slow:o.fast}).delay(function(t){return 0===t.bin_death_index?0:o.slow}).ease(g).st("opacity",1).at("r",function(t){return 0===t.bin_death_index?y:_}).at("transform",function(t){return"translate("+c(t.date)+", "+u(t.views_adjusted)+")"})):(h.selectAll("path").transition().duration(o.slow).ease(g).at("d",v).st("opacity",1).on("end",function(t){t[0].pageid!==f||n||p()}),h.selectAll("circle").transition().duration(o.slow).ease(g).st("opacity",1).at("transform",function(t){return"translate("+c(t.date)+", "+u(t.views_adjusted)+")"})),h.classed("is-highlight",function(t){return t.pageid===f}),h.filter(function(t){return t.pageid===f}).raise(),et({scaleX:c,scaleY:u,annoData:[]}),U(l),n&&!e&&p()},others:function(t){var e=t.reverse,n=t.leave;e||n||nt["prince-spike"]({leave:!0});var o=Q({leave:n,reverse:e}),r=M.map(function(t){return i({},t,{pageviews:$(t.pageviews,{start:0,end:0})})});r.sort(function(t,e){return d3.descending(t.death_views_adjusted_2,e.death_views_adjusted_2)});var a=q(j),s=z(j),c=function(t){return d3.scaleSqrt().domain(d3.extent(t,function(t){return t.death_views_adjusted_2})).nice().range([_,y])}(r);W({scaleX:a,scaleY:s,dur:o,ticks:null}),r.sort(function(t,e){return d3.ascending(+t.timestamp_of_death,+e.timestamp_of_death)});var u=B.selectAll(".person").data(r,function(t){return t.pageid}),l=u.enter().append("g.person").call(V),h=function(){var t=l.merge(u);t.call(G,{scaleX:a,scaleY:s,r:0}),t.selectAll("circle").transition().duration(o.medium).delay(function(t){var e=M.find(function(e){return e.pageid===t.pageid}).index;return o.slow*(e/M.length)}).ease(g).at("r",function(t){return c(t.views_adjusted)}).at("stroke-width",function(t){return c(t.views_adjusted)/2}),t.selectAll(".is-not-death-index").classed("is-transparent",!0)},d=H({scaleX:a,scaleY:s});u.selectAll("path").transition().duration(o.fast).ease(g).st("opacity",0).on("end",function(t,e,n){return d3.select(n[e]).at("d",d)}),u.selectAll("circle").transition().duration(o.slow).ease(g).st("opacity",function(t){return 0===t.bin_death_index?1:0}).at("transform",function(t){return"translate("+a(t.date)+", "+s(t.views_adjusted)+")"}).on("end",function(t){t&&t.pageid===f&&!n&&h()}),u.classed("is-highlight",!1),et({scaleX:a,scaleY:s,annoData:[]}),U(u,o.fast),n&&!e&&h()},compare:function(t){var e=t.reverse,n=t.leave;e||n||nt.others({leave:!0});var o=Q({leave:n,reverse:e}),r=M.map(function(t){return i({},t,{pageviews:$(t.pageviews,{start:-50,end:0})})}),a=[{value:{date:new Date(2016,5,20),views_adjusted:1363387.4582592435},title:"LeBron James (NBA Finals)",padding:0,dx:Math.floor(.01*x),dy:-Math.floor(.07*x),r:6},{value:{date:new Date(2017,0,20),views_adjusted:3398827.436300752},title:"Donald Trump (inauguration)",padding:0,dx:Math.floor(.02*x),dy:-Math.floor(.03*x),r:6},{value:{date:new Date(2018,4,19),views_adjusted:4278495.485411026},title:" Meghan Markle (royal wedding)",padding:0,dx:-Math.floor(.05*x),dy:-Math.floor(.05*x),r:6}];r.sort(function(t,e){return d3.descending(t.death_views_adjusted_2,e.death_views_adjusted_2)});var s=q(j),c=z(j);W({scaleX:s,scaleY:c,dur:o,ticks:null}),r.sort(function(t,e){return d3.ascending(+t.timestamp_of_death,+e.timestamp_of_death)});var u=B.selectAll(".person").data(r,function(t){return t.pageid});u.enter().append("g.person").call(V),u.selectAll("path").transition().duration(o.slow).ease(g).st("opacity",0),u.selectAll("circle").transition().duration(o.slow).ease(g).st("opacity",function(t){return 0===t.bin_death_index?1:0}).at("transform",function(t){return"translate("+s(t.date)+", "+c(t.views_adjusted)+")"}),u.classed("is-highlight",!1),u.exit().transition().duration(o.fast).st("opacity",0).remove(),et(n&&!e?{scaleX:s,scaleY:c,annoData:[]}:{scaleX:s,scaleY:c,annoData:a}),D.x(function(t){return s(t.date)}).y(function(t){return c(t.views_adjusted)}).extent([[-l.left,-l.top],[x+l.left,b+l.top]]);var h=R.selectAll("path"),f=r.map(function(t){return t.pageviews.find(function(t){return 0===t.bin_death_index})}),d=D.polygons(f);h.data(d).enter().append("path").on("mouseenter",K).on("mouseout",tt).merge(h).at("d",function(t){return t?"M"+t.join("L")+"Z":null}),U(u,o.fast)}};function it(t){var e=t.reverse,n=void 0===e||e,i=t.leave,o=void 0!==i&&i;nt[A]&&nt[A]({reverse:n,leave:o})}function ot(){w=window.innerHeight,b=Math.floor(.8*w)-l.top-l.bottom,x=P.node().offsetWidth-l.left-l.right,E.st({height:w,top:m,"padding-bottom":m}),N.at({width:x+l.left+l.right,height:b+l.top+l.bottom}),C.at("transform","translate("+l.left+", "+l.top+")"),R.at("transform","translate("+l.left+", "+l.top+")");var t=T.size();T.st("padding-bottom",w),T.filter(function(t,e){return 0===e}).st("margin-top",.67*-w),T.filter(function(e,n){return n===t-1}).st("padding-bottom",1.2*w),I.resize(),it({reverse:!1,leave:!0})}function rt(t){var e=t.element,n=(t.index,t.direction);A=d3.select(e).at("data-step"),it({reverse:"up"===n})}function at(){O=!0,P.classed("is-hover",!0)}e.default={init:function(){new Promise(function(t,e){var n,o=["people","perspective","beyonce"].map(function(t){return"assets/data/"+t+".csv"});(n=d3).loadData.apply(n,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(o).concat([function(n,o){n&&e(n);var r=s.default.people(o[0]);j=s.default.pageview(o[1]),M=r.map(function(t){return i({},t,{pageviews:j.filter(function(e){return e.pageid===t.pageid})})});var a=s.default.pageview(o[2]);k=[{pageid:"beyonce",pageviews:a.filter(function(t){return t.date>=d&&t.date<p})}],t()}]))}).then(function(){ot(),o.default.add(E.node()),I.setup({step:"#perspective article .step",offset:.99}).onStepEnter(rt),L.setup({step:"#perspective article .step-hover",offset:0}).onStepEnter(at),X=c.default.init({container:P}),N.on("mouseleave",function(){c.default.hide(X)})})},resize:ot}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={android:function(){return navigator.userAgent.match(/Android/i)},blackberry:function(){return navigator.userAgent.match(/BlackBerry/i)},ios:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},opera:function(){return navigator.userAgent.match(/Opera Mini/i)},windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return i.android()||i.blackberry()||i.ios()||i.opera()||i.windows()}};e.default=i},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){(function(e){var n=NaN,i="[object Symbol]",o=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,c=parseInt,u="object"==typeof e&&e&&e.Object===Object&&e,l="object"==typeof self&&self&&self.Object===Object&&self,h=u||l||Function("return this")(),f=Object.prototype.toString,d=Math.max,p=Math.min,_=function(){return h.Date.now()};function y(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function v(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&f.call(t)==i}(t))return n;if(y(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=y(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var u=a.test(t);return u||s.test(t)?c(t.slice(2),u?2:8):r.test(t)?n:+t}t.exports=function(t,e,n){var i,o,r,a,s,c,u=0,l=!1,h=!1,f=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function g(e){var n=i,r=o;return i=o=void 0,u=e,a=t.apply(r,n)}function m(t){var n=t-c;return void 0===c||n>=e||n<0||h&&t-u>=r}function x(){var t=_();if(m(t))return b(t);s=setTimeout(x,function(t){var n=e-(t-c);return h?p(n,r-(t-u)):n}(t))}function b(t){return s=void 0,f&&i?g(t):(i=o=void 0,a)}function w(){var t=_(),n=m(t);if(i=arguments,o=this,c=t,n){if(void 0===s)return function(t){return u=t,s=setTimeout(x,e),l?g(t):a}(c);if(h)return s=setTimeout(x,e),g(c)}return void 0===s&&(s=setTimeout(x,e)),a}return e=v(e)||0,y(n)&&(l=!!n.leading,r=(h="maxWait"in n)?d(v(n.maxWait)||0,e):r,f="trailing"in n?!!n.trailing:f),w.cancel=function(){void 0!==s&&clearTimeout(s),u=0,i=c=o=s=void 0},w.flush=function(){return void 0===s?a:b(_())},w}}).call(this,n(13))},function(t,e,n){"use strict";var i=u(n(14)),o=u(n(12)),r=u(n(11)),a=u(n(6)),s=u(n(5)),c=u(n(4));function u(t){return t&&t.__esModule?t:{default:t}}var l=d3.select("body"),h=0;l.classed("is-mobile",o.default.any()),window.addEventListener("resize",(0,i.default)(function(){var t=l.node().offsetWidth;h!==t&&(h=t,r.default.resize(),s.default.resize(),a.default.resize(),c.default.resize())},150)),function(){if(l.select("header").classed("is-sticky")){var t=l.select(".header__menu"),e=l.select(".header__toggle");e.on("click",function(){var n=t.classed("is-visible");t.classed("is-visible",!n),e.classed("is-visible",!n)})}}(),r.default.init(),s.default.init(),a.default.init(),c.default.init()}]);